(()=>{"use strict";const t={layer1:"./res/bg2/layer-1.png",layer2:"./res/bg2/layer-2.png",layer3:"./res/bg2/layer-3.png",layer4:"./res/bg2/layer-4.png",layer5:"./res/bg2/layer-5.png"},e={action:"./res/ctl/action.svg",down:"./res/ctl/down.svg",full_screen:"./res/ctl/full_screen.svg",icon:"./res/ctl/icon.svg",info:"./res/ctl/info.svg",left:"./res/ctl/left.svg",life_icon_inactive:"./res/ctl/life_icon_inactive.svg",life_icon:"./res/ctl/life_icon.svg",normal_screen:"./res/ctl/normal_screen.svg",pause:"./res/ctl/pause.svg",power_icon_inactive:"./res/ctl/power_icon_inactive.svg",power_icon:"./res/ctl/power_icon.svg",power1:"./res/ctl/power1.svg",power2:"./res/ctl/power2.svg",right:"./res/ctl/right.svg",shield_icon_inactive:"./res/ctl/shield_icon_inactive.svg",shield_icon:"./res/ctl/shield_icon.svg",start:"./res/ctl/start.svg",stopwatch_icon_inactive:"./res/ctl/stopwatch_icon_inactive.svg",stopwatch_icon:"./res/ctl/stopwatch_icon.svg",up:"./res/ctl/up.svg"},i={enemy1:"./res/enemy/enemy1.png",enemy2:"./res/enemy/enemy2.png",enemy3:"./res/enemy/enemy3.png",enemy4:"./res/enemy/enemy4.png",enemy5:"./res/enemy/enemy5.png",enemy6:"./res/enemy/enemy6.png",enemy7:"./res/enemy/enemy7.png",enemy8:"./res/enemy/enemy8.png",enemy9:"./res/enemy/enemy9.png",enemy10:"./res/enemy/enemy10.png",enemy11:"./res/enemy/enemy11.png"},s="./res/boom.png",h="./res/boom.wav",a="./res/fire.png",r="./res/player.png",_=Math.PI,n=2*_,l=t=>t+(t<0?-1:0)>>0;let o=0;const c=Array(32e3).fill(0).map((t=>Math.random())),d=()=>++o>=32e3?c[o=0]:c[o],g=()=>Array(3).fill(0).map((t=>l(255*d()))),p="255,36,0",x="255,215,0",u="42, 170, 138",m="0, 150, 255",w="255, 255, 255",y="0, 0, 0",v=()=>"ontouchstart"in window||navigator.maxTouchPoints>0,b=()=>window.innerHeight===screen.height,f=window.devicePixelRatio,k=t=>{t.font_family??="Creepster",t.font_weight??=20,t.shadow_blur??=2,t.text_align??="left",t.debug??=!1;const e=(t=>{t.font_family??="Creepster",t.font_weight??=20,t.text_align??="left",t.ctx.save(),t.ctx.font=`${t.font_weight}px ${t.font_family}`,t.ctx.textAlign=t.text_align;const e=t.ctx.measureText(` ${t.text.toUpperCase()} `);return t.ctx.restore(),{w:e.width,h:e.actualBoundingBoxAscent+e.actualBoundingBoxDescent}})({ctx:t.ctx,text:t.text,font_weight:t.font_weight,font_family:t.font_family,text_align:t.text_align});let i=0,s=0,h=0,a=0;"start"===t.text_align||"left"===t.text_align?(i=t.x,s=t.y-e.h,h=e.w+t.shadow_blur,a=e.h+t.shadow_blur):"end"===t.text_align||"right"===t.text_align?(i=t.x-e.w,s=t.y-e.h,h=e.w+t.shadow_blur,a=e.h+t.shadow_blur):(i=t.x-.5*e.w,s=t.y-e.h,h=e.w+t.shadow_blur,a=e.h+t.shadow_blur);t.ctx.clearRect(l(i-4),l(s-4),l(h+8),l(a+8)),t.debug&&t.ctx.strokeRect(l(i-4),l(s-4),l(h+8),l(a+8))},E=t=>{t.font_family??="Creepster",t.font_weight??=20,t.text_color??=`rgb(${w})`,t.shadow_color??=`rgb(${y})`,t.shadow_blur??=2,t.text_align??="left",t.debug??=!1,k(t),S(t)},S=t=>{t.font_family??="Creepster",t.font_weight??=20,t.text_color??=`rgb(${w})`,t.shadow_color??=`rgb(${y})`,t.shadow_blur??=2,t.text_align??="left",t.debug??=!1,t.ctx.save(),t.ctx.textAlign=t.text_align,t.ctx.font=`${t.font_weight}px ${t.font_family}`,t.ctx.fillStyle=t.shadow_color,t.ctx.fillText(t.text,l(t.x+t.shadow_blur),l(t.y+t.shadow_blur)),t.ctx.fillStyle=t.text_color,t.ctx.fillText(t.text,l(t.x),l(t.y)),t.ctx.restore()};class R{ctx;img;x;y;width;height;ratio;canvas_width;canvas_height;x2;speed_modifier;constructor(t){this.img=t.img,this.ctx=t.ctx,this.x=0,this.y=0,this.width=t.width,this.height=t.height,this.canvas_height=t.canvas_height,this.ratio=this.width/this.height,this.canvas_width=this.canvas_height*this.ratio,this.speed_modifier=t.speed_modifier,this.x2=this.x+this.width}update(t){this.x-=t*this.speed_modifier,this.x<0-this.width&&(this.x=0),this.x2=this.x+this.width-t-1}draw(){this.ctx.drawImage(this.img,l(this.x),l(this.y),this.width,this.height),this.ctx.drawImage(this.img,l(this.x2),l(this.y),this.width,this.height)}}class ${ctx;width;height;ground;canvas_width;canvas_height;img_setup=t=>{const e=new Image;return e.src=t,e};bg_list=[];constructor(t){this.ctx=t.ctx,this.width=t.width,this.height=t.height,this.ground=t.ground,this.canvas_width=t.canvas_width,this.canvas_height=t.canvas_height,t.img.forEach((t=>{this.bg_list.push(new R({ctx:this.ctx,img:this.img_setup(t.url),canvas_height:this.canvas_height,width:this.width,height:this.height,speed_modifier:t.speed_modifier}))}))}update=t=>{this.bg_list.forEach((e=>{e.update(t.game_speed)}))};draw=()=>{this.bg_list.forEach((t=>{t.draw()}))}}class P extends ${constructor(e){super({ctx:e.ctx,img:[{url:t.layer1,speed_modifier:.2},{url:t.layer2,speed_modifier:.4},{url:t.layer3,speed_modifier:.6},{url:t.layer4,speed_modifier:.8},{url:t.layer5,speed_modifier:1}],canvas_width:e.canvas_width,canvas_height:e.canvas_height,width:2400,height:700,ground:50})}}class j{ctx;fps;frame;frame_timer;frame_interval;frame_y;frame_x;mark_delete;img;x;y;width;height;sprite_width;sprite_height;sprite_length;animation_repeat;animation_repeat_index;constructor(t){t.fps??=20,t.animation_repeat??=0,this.ctx=t.ctx,this.fps=t.fps,this.frame=0,this.frame_timer=0,this.frame_interval=1e3/this.fps,this.frame_y=0,this.frame_x=0,this.mark_delete=!1,this.img=t.img,this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.sprite_length=t.sprite_length,this.sprite_width=t.sprite_width,this.sprite_height=t.sprite_height,this.animation_repeat=t.animation_repeat,this.animation_repeat_index=0}update(t){this.frame_timer>=this.frame_interval?(this.frame_timer=0,this.frame>=this.sprite_length?0===this.animation_repeat?this.frame=0:this.animation_repeat>0?(this.animation_repeat_index++,this.animation_repeat_index>=this.animation_repeat?t.onframecomplete&&t.onframecomplete():this.frame=0):this.mark_delete=!0:(this.frame++,this.frame_x=this.frame*this.sprite_width,t.onframechange&&t.onframechange())):this.frame_timer+=t.delta_time}draw(){this.ctx.drawImage(this.img,this.frame_x,this.frame_y,this.sprite_width,this.sprite_height,l(this.x),l(this.y),this.width,this.height)}set_position(t){this.x-=t.game_speed,this.x<0-this.width&&(this.mark_delete=!0)}}class I extends j{debug=!1;uid;uid_text;uid_number;ctx_collision;canvas_width;canvas_height;point;explode_in;explode_out;have_particle;collision_x;collision_y;collision_adjust_x;collision_adjust_y;collision_scale;constructor(t){super(t),t.debug??=!1,t.explode_in??=!1,t.explode_out??=!1,t.have_particle??=!1,t.point??=1,t.collision_scale??=.5,t.collision_x??=0,t.collision_y??=0,this.debug=t.debug,this.uid=g(),this.uid_number=`${this.uid[0]},${this.uid[1]},${this.uid[2]}`,this.uid_text=`rgb(${this.uid[0]},${this.uid[1]},${this.uid[2]})`,this.canvas_width=t.canvas_width,this.canvas_height=t.canvas_height,this.explode_in=t.explode_in,this.explode_out=t.explode_out,this.have_particle=t.have_particle,this.point=t.point,this.collision_scale=t.collision_scale,this.collision_adjust_x=t.collision_x,this.collision_adjust_y=t.collision_y,this.collision_x=this.x+this.collision_adjust_x+this.width*this.collision_scale,this.collision_y=this.y+this.collision_adjust_y+this.height*this.collision_scale}update(t){super.update(t),this.collision_x=this.x+this.collision_adjust_x+this.width*this.collision_scale,this.collision_y=this.y+this.collision_adjust_y+this.height*this.collision_scale}draw(){this.ctx_collision&&(this.ctx_collision.fillStyle=this.uid_text,this.ctx_collision.fillRect(l(this.x),l(this.y),this.width,this.height)),super.draw(),this.debug&&(this.ctx.save(),this.ctx.strokeStyle=`rgb(${w})`,this.ctx.beginPath(),this.ctx.arc(l(this.collision_x),l(this.collision_y),100*this.collision_scale,0,n),this.ctx.stroke(),this.ctx.restore())}set_position(t){super.set_position(t),this.collision_x=this.x+this.collision_adjust_x+this.width*this.collision_scale}is_collide(t){const e=this.collision_x-t.player.collision_x,i=this.collision_y-t.player.collision_y;return Math.sqrt(e*e+i*i)<this.width*this.collision_scale+t.player.width*t.player.collision_scale}}const A=new Image;A.src=i.enemy1;const T=new Image;T.src=i.enemy2;const L=new Image;L.src=i.enemy3;const z=new Image;z.src=i.enemy4;const C=new Image;C.src=i.enemy5;const F=new Image;F.src=i.enemy6;const B=new Image;B.src=i.enemy7;const D=new Image;D.src=i.enemy8;const M=new Image;M.src=i.enemy9;const q=new Image;q.src=i.enemy10;const K=new Image;K.src=i.enemy11;const U=new Image;U.src=s;const N=h;class O extends j{sound_played;sound;angle;dx;dy;sx;constructor(t){const e=200*t.scale,i=179*t.scale;super({img:U,ctx:t.ctx,x:t.x,y:t.y,width:e,height:i,sprite_width:200,sprite_height:179,sprite_length:5,fps:30,animation_repeat:1}),t.play_sound??=!0,t.play_sound&&(this.sound_played=!1,this.sound=N),this.angle=180*d(),this.dx=0-.5*this.width,this.dy=0-.5*this.height,this.sx=0}update(t){this.sound&&!this.sound_played&&(this.sound_played=!0,new Audio(this.sound).play()),super.update({delta_time:t.delta_time,onframechange:()=>{this.sx=this.sprite_width*this.frame}})}draw(){this.ctx.save(),this.ctx.translate(this.x,this.y),this.ctx.rotate(this.angle),this.ctx.drawImage(this.img,l(this.sx),0,this.sprite_width,this.sprite_width,l(this.dx),l(this.dy),this.width,this.height),this.ctx.restore()}}class W{ctx;x;y;speed_x;speed_y;size;mark_delete;constructor(t){t.speed_x??=d(),t.speed_y??=d(),t.size??=10*d()+10,this.ctx=t.ctx,this.x=t.x,this.y=t.y,this.speed_x=t.speed_x,this.speed_y=t.speed_y,this.size=t.size,this.mark_delete=!1}update(){this.x-=this.speed_x,this.y-=this.speed_y,this.size*=.97,this.size<.5&&(this.mark_delete=!0)}set_position(t){this.x-=t.game_speed,this.x<0-this.size&&(this.mark_delete=!0)}}const G=new Image;G.src=a;class X extends W{img;img_size;constructor(t){super({ctx:t.ctx,x:t.x,y:t.y,size:100*d()+50}),this.img=G,this.img_size=.5*-this.size}update(){super.update(),this.img_size=.5*-this.size}draw(){this.ctx.drawImage(this.img,l(this.x),l(this.y),this.size,this.size)}}const Y={idle:{frame_y:0,sprite_length:7,animation_repeat:0,collision_adjust_x:0,collision_adjust_y:0},jump:{frame_y:1,sprite_length:7,animation_repeat:0,collision_adjust_x:0,collision_adjust_y:0},fall:{frame_y:2,sprite_length:7,animation_repeat:0,collision_adjust_x:0,collision_adjust_y:0},run:{frame_y:3,sprite_length:8,animation_repeat:0,collision_adjust_x:0,collision_adjust_y:0},dizzy:{frame_y:4,sprite_length:11,animation_repeat:3,collision_adjust_x:0,collision_adjust_y:0},sit:{frame_y:5,sprite_length:5,animation_repeat:0,collision_adjust_x:0,collision_adjust_y:15},roll:{frame_y:6,sprite_length:7,animation_repeat:0,collision_adjust_x:-2,collision_adjust_y:22},jump_roll:{frame_y:6,sprite_length:7,animation_repeat:0,collision_adjust_x:-2,collision_adjust_y:22},fall_roll:{frame_y:6,sprite_length:7,animation_repeat:0,collision_adjust_x:-2,collision_adjust_y:22},power_fall:{frame_y:6,sprite_length:7,animation_repeat:0,collision_adjust_x:-2,collision_adjust_y:22},bite:{frame_y:7,sprite_length:7,animation_repeat:1,collision_adjust_x:15,collision_adjust_y:8},ko:{frame_y:8,sprite_length:12,animation_repeat:1,collision_adjust_x:0,collision_adjust_y:30},gethit:{frame_y:9,sprite_length:4,animation_repeat:1,collision_adjust_x:0,collision_adjust_y:0}};class H{current_state;player;constructor(t,e){this.current_state=t,this.player=e}enter(){this.player.frame=0,this.player.frame_x=0,this.player.animation_repeat_index=0,this.player.collision_adjust_x=Y[this.current_state].collision_adjust_x,this.player.collision_adjust_y=Y[this.current_state].collision_adjust_y,this.player.frame_y=Y[this.current_state].frame_y*this.player.sprite_height,this.player.sprite_length=Y[this.current_state].sprite_length-1,this.player.animation_repeat=Y[this.current_state].animation_repeat}exit(){}update(){}handle_input(t){}animation_end(t){}}class J extends H{constructor(t){super("idle",t)}enter(){super.enter(),this.player.speed=0}handle_input(t){"PRESS right"===t.last_key&&this.player.set_state("run"),"PRESS up"===t.last_key&&this.player.set_state("jump"),"PRESS down"===t.last_key&&this.player.set_state("sit"),"PRESS space"===t.last_key&&this.player.set_state("bite"),"PRESS control"===t.last_key&&this.player.set_state("roll")}}class Q extends H{constructor(t){super("jump",t)}enter(){super.enter(),this.player.is_ground()&&(this.player.weight=1,this.player.velocity_y-=32)}update(){super.update(),this.player.velocity_y>0&&this.player.set_state("fall")}handle_input(t){"PRESS down"===t.last_key&&(this.player.velocity_y=0,this.player.set_state("fall")),"PRESS control"===t.last_key&&this.player.power>10&&this.player.set_state("jump_roll")}}class V extends H{constructor(t){super("fall",t)}enter(){super.enter()}update(){super.update(),this.player.is_ground()&&(this.player.speed>0?this.player.set_state("run"):this.player.set_state("idle"))}handle_input(t){"PRESS control"===t.last_key&&this.player.power>10&&this.player.set_state("fall_roll"),"PRESS down"===t.last_key&&this.player.power>10&&this.player.set_state("power_fall")}}class Z extends H{constructor(t){super("power_fall",t)}enter(){super.enter(),this.player.weight=20,this.player.speed=this.player.max_speed}exit(){super.exit(),this.player.weight=1,this.player.speed=.5*this.player.max_speed}update(){super.update(),this.player.power--,this.player.is_ground()?this.player.set_state("run"):this.player.power<=0&&this.player.set_state("fall")}handle_input(t){"RELESE down"===t.last_key&&this.player.set_state("fall")}}class tt extends H{constructor(t){super("run",t)}enter(){super.enter(),this.player.speed=.5*this.player.max_speed}handle_input(t){"PRESS left"===t.last_key&&this.player.set_state("idle"),"PRESS down"===t.last_key&&this.player.set_state("sit"),"PRESS up"===t.last_key&&this.player.set_state("jump"),"PRESS space"===t.last_key&&this.player.set_state("bite"),"PRESS control"===t.last_key&&this.player.power>10&&this.player.set_state("roll")}}class et extends H{constructor(t){super("dizzy",t)}enter(){super.enter(),this.player.speed=0,this.player.invulnerable=!0}exit(){setTimeout((()=>{this.player.invulnerable=!1}),500)}animation_end(t){t.set_state("idle")}}class it extends H{constructor(t){super("sit",t)}enter(){super.enter(),this.player.invulnerable=!0,this.player.speed=0}exit(){this.player.invulnerable=!1}update(){super.update(),this.player.power+=.5}handle_input(t){"RELEASE down"!==t.last_key&&"PRESS up"!==t.last_key&&"PRESS left"!==t.last_key||this.player.set_state("idle"),"PRESS left"===t.last_key&&this.player.set_state("run")}}class st extends H{constructor(t){super("roll",t)}enter(){super.enter(),this.player.speed=this.player.max_speed}update(){super.update(),this.player.power--,this.player.power<=0&&(this.player.power=0,this.player.set_state("run"))}handle_input(t){"RELEASE control"===t.last_key&&this.player.set_state("run")}}class ht extends H{constructor(t){super("jump_roll",t)}enter(){super.enter(),this.player.speed=this.player.max_speed}exit(){this.player.speed=.5*this.player.max_speed}update(){super.update(),this.player.power--,this.player.velocity_y>0?this.player.power<=0?this.player.set_state("fall"):this.player.set_state("fall_roll"):this.player.power<=0&&this.player.set_state("jump")}handle_input(t){"RELEASE control"===t.last_key&&(this.player.velocity_y>0?this.player.set_state("fall"):this.player.set_state("jump"))}}class at extends H{constructor(t){super("fall_roll",t)}enter(){super.enter(),this.player.speed=this.player.max_speed}exit(){this.player.speed=.5*this.player.max_speed}update(){super.update(),this.player.is_ground()?this.player.set_state("roll"):(this.player.power--,this.player.power<=0&&this.player.set_state("fall"))}handle_input(t){"RELEASE control"===t.last_key&&this.player.set_state("fall")}}class rt extends H{constructor(t){super("bite",t)}enter(){super.enter(),this.player.powered=!0,this.player.invulnerable=!0,this.player.speed=0}exit(){setTimeout((()=>{this.player.powered=!1,this.player.invulnerable=!1}),500)}animation_end(t){t.set_state("idle")}}class _t extends H{constructor(t){super("ko",t)}enter(){super.enter(),this.player.weight=20,this.player.invulnerable=!0,this.player.speed=0}}class nt extends H{constructor(t){super("gethit",t)}enter(){super.enter(),this.player.invulnerable=!0,this.player.speed=0}exit(){setTimeout((()=>{this.player.invulnerable=!1}),500)}animation_end(t){t.set_state("idle")}}class lt extends j{debug=!1;game;state_list={};current_state;canvas_width;canvas_height;invulnerable;powered;power;speed;life;max_speed;velocity_y;weight;collision_scale=.5;collision_adjust_x=0;collision_adjust_y=0;collision_x;collision_y;img_life;img_life_inactive;img_power;img_power_inactive;img_stopwatch;img_stopwatch_inactive;img_shield;img_shield_inactive;constructor(t){const i=new Image;i.src=r;const s=130.75;super({img:i,ctx:t.ctx,x:t.x,y:t.canvas_height-s,width:143.75,height:s,sprite_width:575,sprite_height:523,sprite_length:0}),t.debug??=!1,this.debug=t.debug,this.game=t.game,this.img_life=new Image,this.img_life.src=e.life_icon,this.img_power=new Image,this.img_power.src=e.power_icon,this.img_stopwatch=new Image,this.img_stopwatch.src=e.stopwatch_icon,this.img_shield=new Image,this.img_shield.src=e.shield_icon,this.img_life_inactive=new Image,this.img_life_inactive.src=e.life_icon_inactive,this.img_power_inactive=new Image,this.img_power_inactive.src=e.power_icon_inactive,this.img_stopwatch_inactive=new Image,this.img_stopwatch_inactive.src=e.stopwatch_icon_inactive,this.img_shield_inactive=new Image,this.img_shield_inactive.src=e.shield_icon_inactive,this.canvas_width=t.canvas_width,this.canvas_height=t.canvas_height,this.collision_x=this.x+this.collision_adjust_x+this.width*this.collision_scale,this.collision_y=this.y+this.collision_adjust_y+this.height*this.collision_scale,this.velocity_y=0,this.weight=1,this.speed=0,this.life=100,this.max_speed=14,this.power=100,this.powered=!1,this.invulnerable=!1,this.state_list={idle:new J(this),jump:new Q(this),fall:new V(this),power_fall:new Z(this),run:new tt(this),dizzy:new et(this),sit:new it(this),roll:new st(this),jump_roll:new ht(this),fall_roll:new at(this),bite:new rt(this),ko:new _t(this),gethit:new nt(this)},this.current_state=this.state_list.idle}update_input(t){this.current_state?.handle_input(t)}is_ground(){return this.y>=this.canvas_height-this.height}is_powered(){return this.powered||this.speed===this.max_speed}set_state=t=>{this.current_state?.exit(),this.current_state=this.state_list[t],this.current_state?.enter()};update(t){this.y+=this.velocity_y,this.is_ground()?this.velocity_y=0:this.velocity_y+=this.weight,this.y>this.canvas_height-this.height&&(this.y=this.canvas_height-this.height),this.power+=.1,this.power>100&&(this.power=100),this.power<0&&(this.power=0),this.current_state?.update(),super.update({delta_time:t.delta_time,onframecomplete:()=>{this.current_state?.animation_end(this)}}),this.collision_x=this.x+this.collision_adjust_x+this.width*this.collision_scale,this.collision_y=this.y+this.collision_adjust_y+this.height*this.collision_scale}draw(){super.draw(),this.power>=100?this.ctx.drawImage(this.img_power,l(this.x+.5*this.width),l(this.y+10),16,16):this.ctx.drawImage(this.img_power_inactive,l(this.x+.5*this.width),l(this.y+10),16,16),this.life<30?this.ctx.drawImage(this.img_life,l(this.x+.5*this.width+20),l(this.y+10),16,16):this.ctx.drawImage(this.img_life_inactive,l(this.x+.5*this.width+20),l(this.y+10),16,16),this.game.progress_timer_index<20?this.ctx.drawImage(this.img_stopwatch,l(this.x+.5*this.width-20),l(this.y+10),16,16):this.ctx.drawImage(this.img_stopwatch_inactive,l(this.x+.5*this.width-20),l(this.y+10),16,16),this.invulnerable||this.is_powered()?this.ctx.drawImage(this.img_shield,l(this.x+.5*this.width-40),l(this.y+10),16,16):this.ctx.drawImage(this.img_shield_inactive,l(this.x+.5*this.width-40),l(this.y+10),16,16),this.debug&&(this.ctx.save(),this.ctx.strokeStyle=`rgb(${w})`,this.ctx.beginPath(),this.ctx.arc(l(this.collision_x),l(this.collision_y),100*this.collision_scale,0,n),this.ctx.stroke(),this.ctx.restore())}}class ot{ctx;x;y;min;max;width;height;value;percent;bar_color;bar_x;bar_y;bar_width;bar_max_width;bar_height;radius;padding;constructor(t){t.shadow_color??="#555555",t.shadow_blur??=1,t.bg_color??="#FFFFFF",t.bar_color??="#555555",t.radius??=5,t.padding??=2,t.min??=0,t.max??=1e3,t.height??=20,t.value??=0,this.ctx=t.ctx,this.x=t.x,this.y=t.y,this.min=t.min,this.max=t.max,this.width=t.width,this.height=t.height,this.value=t.value,this.percent=this.value/this.max,this.radius=t.radius,this.padding=t.padding,this.bar_x=this.x+this.padding,this.bar_y=this.y+this.padding,this.bar_height=this.height-2*this.padding,this.bar_max_width=this.width-2*this.padding,this.bar_width=this.bar_max_width*this.percent,this.bar_color=t.bar_color}update(t,e,i){this.min=e??this.min,this.max=i??this.max,this.value=t,this.value<this.min&&(this.value=this.min),this.value>this.max&&(this.value=this.max),this.percent=this.value/this.max,this.bar_width=(this.width-2*this.padding)*this.percent}clean(){this.ctx.clearRect(l(this.bar_x),l(this.bar_y),this.bar_max_width,this.bar_height)}draw(){this.clean(),this.ctx.save(),this.radius?(this.ctx.beginPath(),this.ctx.fillStyle=this.gradient_bar_color(this.bar_color,l(this.bar_x),l(this.bar_max_width)),this.ctx.roundRect(l(this.bar_x),l(this.bar_y),this.bar_width,this.bar_height,[this.radius]),this.ctx.fill()):(this.ctx.fillStyle=this.gradient_bar_color(this.bar_color,l(this.bar_x),l(this.bar_max_width)),this.ctx.fillRect(l(this.bar_x),l(this.bar_y),this.bar_width,this.bar_height)),this.ctx.restore()}gradient_bar_color(t,e,i){if(Array.isArray(t)){if(t.length>=2){const s=100/(t.length-1)/100;let h=this.ctx.createLinearGradient(e,0,i+e,0);return t.forEach(((t,e)=>{h.addColorStop(e*s,t)})),h}return 1===t.length&&t[0]?t[0]:`rgb(${y})`}return t}}class ct{key_filter=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"," ","Control","Enter"];last_key;constructor(){this.last_key="",window.addEventListener("keydown",(t=>{this.key_filter.indexOf(t.key)>-1&&(t.preventDefault(),t.stopPropagation(),"ArrowLeft"===t.key&&(this.last_key="PRESS left"),"ArrowRight"===t.key&&(this.last_key="PRESS right"),"ArrowUp"===t.key&&(this.last_key="PRESS up"),"ArrowDown"===t.key&&(this.last_key="PRESS down")," "===t.key&&(this.last_key="PRESS space"),"Control"===t.key&&(this.last_key="PRESS control"),"Enter"===t.key&&(this.last_key="PRESS enter"),console.log(this.last_key))})),window.addEventListener("keyup",(t=>{this.key_filter.indexOf(t.key)>-1&&(t.preventDefault(),t.stopPropagation(),"ArrowLeft"===t.key&&(this.last_key="RELEASE left"),"ArrowRight"===t.key&&(this.last_key="RELEASE right"),"ArrowUp"===t.key&&(this.last_key="RELEASE up"),"ArrowDown"===t.key&&(this.last_key="RELEASE down")," "===t.key&&(this.last_key="RELEASE space"),"Control"===t.key&&(this.last_key="RELEASE control"),"Enter"===t.key&&(this.last_key="RELEASE enter"),console.log(this.last_key))}))}}class dt{ctx;text;value;x;y;destination_x;destination_y;speed_x;speed_y;mark_delete;timer;constructor(t){this.ctx=t.ctx,this.text=t.text,this.value=t.value,this.x=t.x,this.y=t.y,this.destination_x=t.destination_x,this.destination_y=t.destination_y,this.speed_x=.01*(this.destination_x-this.x),this.speed_y=.01*(this.destination_y-this.y),this.mark_delete=!1,this.timer=100}update(){this.x+=this.speed_x,this.y+=this.speed_y,this.timer--,this.timer<=0&&(this.mark_delete=!0)}draw(){S({text_color:this.value<=0?`rgb(${p})`:`rgb(${w})`,ctx:this.ctx,x:this.x,y:this.y,text:this.text,font_weight:30})}}class gt extends W{color;constructor(t){super({ctx:t.ctx,x:t.x,y:t.y}),this.color=t.color}draw(){this.ctx.beginPath(),this.ctx.arc(l(this.x),l(this.y),this.size,0,n),this.ctx.fillStyle=this.color,this.ctx.fill()}}const pt=35*f,xt=20*f,ut=30,mt={normal:`rgba(${y}, 0.5)`,highlight:`rgba(${m}, 0.5)`,click:`rgba(${m}, 0.5)`,active:`rgba(${m}, 0.5)`};class wt{debug;ctx;ctx_mark;name;x;y;uid;uid_text;uid_number;img;img_url;img_width;img_height;color;width;height;padding;line_width;constructor(t){t.width??=pt,t.height??=pt,t.img_width??=16,t.img_height??=16,t.padding??=.4*pt,t.color??=mt.normal,t.line_width??=2,t.debug??=!1,this.debug=t.debug,this.ctx=t.ctx,this.ctx_mark=t.ctx_mark,this.uid=g(),this.uid_number=`${this.uid[0]},${this.uid[1]},${this.uid[2]}`,this.uid_text=`rgb(${this.uid[0]},${this.uid[1]},${this.uid[2]})`,this.name=t.name,this.img=new Image,this.img.src=t.img,this.img_url=t.img,this.img_width=t.img_width,this.img_height=t.img_height,this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.padding=t.padding,this.color=t.color,this.line_width=t.line_width}clear(){this.ctx.clearRect(l(this.x-2),l(this.y-2),pt+4,pt+4),this.debug&&this.ctx.strokeRect(l(this.x-2),l(this.y-2),pt+4,pt+4)}draw(){this.clear(),this.ctx.save(),this.ctx.fillStyle=this.color,this.ctx.strokeStyle=this.color,this.ctx.lineWidth=this.line_width,this.ctx.beginPath(),this.ctx.arc(l(this.x+.5*this.width),l(this.y+.5*this.width),.5*pt,0,n),this.ctx.fill(),this.ctx.stroke(),this.ctx.restore(),this.ctx.drawImage(this.img,0,0,this.img_width,this.img_height,l(this.x+.5*(this.width-(this.width-this.padding))),l(this.y+.5*(this.height-(this.height-this.padding))),this.width-this.padding,this.height-this.padding)}clear_mark(){this.ctx_mark.clearRect(l(this.x-.25*pt-2),l(this.y-.25*pt-2),1.5*pt+4,1.5*pt+4),this.debug&&this.ctx_mark.strokeRect(l(this.x-.25*pt-2),l(this.y-.25*pt-2),1.5*pt+4,1.5*pt+4)}draw_mark(){this.clear_mark(),this.ctx_mark.fillStyle=this.uid_text,this.ctx_mark.beginPath(),this.ctx_mark.arc(l(this.x+.5*this.width),l(this.y+.5*this.width),.75*pt,0,n),this.ctx_mark.fill()}}class yt{debug;ctx;ctx_mark;name;x;y;uid;uid_text;uid_number;img;img_url;img_width;img_height;width;height;padding;color;line_width;btn_width;hole_width;start_degree;end_degree;constructor(t){t.hole_width??=.5*pt,t.btn_width??=.5*pt+t.hole_width,t.padding??=.4*t.btn_width,t.color??=mt.normal,t.line_width??=2,t.img_width??=16,t.img_height??=16,t.width??=t.btn_width,t.height??=t.btn_width,t.debug??=!1,this.debug=t.debug,this.ctx=t.ctx,this.ctx_mark=t.ctx_mark,this.uid=g(),this.uid_number=`${this.uid[0]},${this.uid[1]},${this.uid[2]}`,this.uid_text=`rgb(${this.uid[0]},${this.uid[1]},${this.uid[2]})`,this.name=t.name,this.img=new Image,this.img.src=t.img,this.img_url=t.img,this.img_width=t.img_width,this.img_height=t.img_height,this.width=t.width,this.height=t.height,this.x=t.x,this.y=t.y,this.hole_width=t.hole_width,this.btn_width=t.btn_width+this.hole_width,this.start_degree=t.start_degree,this.end_degree=t.end_degree,this.color=t.color,this.padding=t.padding,this.line_width=t.line_width}clear(){this.draw_clear({ctx:this.ctx,x:this.x,y:this.y,hole_width:this.hole_width,btn_width:this.btn_width,start_degree:this.start_degree,end_degree:this.end_degree,line_width:this.line_width})}draw(){this.clear(),this.draw_fill({ctx:this.ctx,x:this.x,y:this.y,hole_width:this.hole_width,btn_width:this.btn_width,start_degree:this.start_degree,end_degree:this.end_degree,color:this.color}),this.draw_line({ctx:this.ctx,x:this.x,y:this.y,hole_width:this.hole_width,btn_width:this.btn_width,start_degree:this.start_degree,end_degree:this.end_degree,color:this.color,line_width:this.line_width}),this.draw_img({ctx:this.ctx,x:this.x,y:this.y,hole_width:this.hole_width,btn_width:this.btn_width,start_degree:this.start_degree,end_degree:this.end_degree})}clear_mark(){this.draw_clear({ctx:this.ctx_mark,x:this.x,y:this.y,hole_width:this.hole_width,btn_width:this.btn_width,start_degree:this.start_degree,end_degree:this.end_degree,line_width:this.line_width})}draw_mark(){this.clear_mark(),this.draw_fill({ctx:this.ctx_mark,x:this.x,y:this.y,hole_width:this.hole_width,btn_width:this.btn_width,start_degree:this.start_degree,end_degree:this.end_degree,color:this.uid_text})}calc_middle_degree(t,e){if(t>e){let i=360-t;return.5*(e+i)-i}{let i=.5*((t=(t%360+360)%360)+(e=(e%360+360)%360));return i=(i%360+360)%360,i}}calc_degree(t){return t>360?this.calc_degree(360-t):t<0?this.calc_degree(360+t):360===t?0:t}get_angle_position(t,e,i,s){const h=s*_/180,a=t+i*Math.cos(h),r=e+i*Math.sin(h);return{x:l(a),y:l(r)}}angle_degree_for_arc(t){return _*(t*(2/360))}draw_fill(t){t.ctx.save(),t.ctx.beginPath(),t.ctx.fillStyle=t.color,t.ctx.arc(t.x,t.y,t.hole_width,this.angle_degree_for_arc(t.start_degree),this.angle_degree_for_arc(t.end_degree));let e=this.get_angle_position(t.x,t.y,t.btn_width,t.end_degree);t.ctx.lineTo(e.x,e.y),t.ctx.arc(t.x,t.y,t.btn_width,this.angle_degree_for_arc(t.end_degree),this.angle_degree_for_arc(t.start_degree),!0);let i=this.get_angle_position(t.x,t.y,t.hole_width,t.start_degree);t.ctx.lineTo(i.x,i.y),t.ctx.fill(),t.ctx.restore()}draw_line(t){t.ctx.save(),t.ctx.beginPath(),t.ctx.strokeStyle=t.color,t.ctx.lineWidth=t.line_width,t.ctx.arc(t.x,t.y,t.hole_width,this.angle_degree_for_arc(t.start_degree),this.angle_degree_for_arc(t.end_degree));let e=this.get_angle_position(t.x,t.y,t.btn_width,t.end_degree);t.ctx.lineTo(e.x,e.y),t.ctx.arc(t.x,t.y,t.btn_width,this.angle_degree_for_arc(t.end_degree),this.angle_degree_for_arc(t.start_degree),!0);let i=this.get_angle_position(t.x,t.y,t.hole_width,t.start_degree);t.ctx.lineTo(i.x,i.y),t.ctx.stroke(),t.ctx.restore()}draw_clear(t){t.ctx.save(),t.ctx.globalCompositeOperation="destination-out",t.ctx.beginPath(),t.ctx.fillStyle="black",t.ctx.strokeStyle="black",t.ctx.lineWidth=t.line_width,t.ctx.arc(t.x,t.y,t.hole_width-t.line_width,this.angle_degree_for_arc(this.calc_degree(t.start_degree-t.line_width)),this.angle_degree_for_arc(this.calc_degree(t.end_degree+2*t.line_width)));let e=this.get_angle_position(t.x,t.y,t.btn_width+2*t.line_width,this.calc_degree(t.end_degree+2*t.line_width));t.ctx.lineTo(e.x,e.y),t.ctx.arc(t.x,t.y,t.btn_width+2*t.line_width,this.angle_degree_for_arc(this.calc_degree(t.end_degree+2*t.line_width)),this.angle_degree_for_arc(this.calc_degree(t.start_degree-t.line_width)),!0);let i=this.get_angle_position(t.x,t.y,t.hole_width-t.line_width,this.calc_degree(t.start_degree-t.line_width));t.ctx.lineTo(i.x,i.y),t.ctx.fill(),t.ctx.restore()}draw_img(t){t.ctx.save();const e=this.calc_middle_degree(t.start_degree,t.end_degree),i=this.get_angle_position(this.x,this.y,this.btn_width-this.hole_width,e);let s=i.x-.5*this.width,h=i.y-.5*this.height;t.ctx.drawImage(this.img,0,0,this.img_width,this.img_height,l(s+.5*(this.width-(this.width-this.padding))),l(h+.5*(this.height-(this.height-this.padding))),this.width-this.padding,this.height-this.padding),t.ctx.restore()}}class vt{debug;canvas_width;canvas_height;button_pause;button_fullscreen;button_power;button_action;arrow_right;arrow_down;arrow_left;arrow_up;btn_list=[];btn_gui_list=[];btn_control_list=[];arrow_list=[];canvas_rect;canvas_mark;canvas_control;canvas_pointer;ctx_mark;ctx_control;ctx_pointer;constructor(t){t.debug??=!1,this.debug=t.debug,this.canvas_mark=t.canvas_mark,this.canvas_control=t.canvas_control,this.canvas_pointer=t.canvas_pointer,this.ctx_mark=t.ctx_mark,this.ctx_control=t.ctx_control,this.ctx_pointer=t.ctx_pointer,this.canvas_width=t.canvas_width,this.canvas_height=t.canvas_height,this.canvas_rect=this.canvas_mark.getBoundingClientRect();const i=70*f,s=this.canvas_height-70*f,h=5*f;this.arrow_right=new yt({ctx:this.ctx_control,ctx_mark:this.ctx_mark,debug:this.debug,name:"ArrowRight",img:e.right,x:i+h,y:s-h,start_degree:315,end_degree:45}),this.arrow_down=new yt({ctx:this.ctx_control,ctx_mark:this.ctx_mark,debug:this.debug,name:"ArrowDown",img:e.down,x:i,y:s,start_degree:45,end_degree:135}),this.arrow_left=new yt({ctx:this.ctx_control,ctx_mark:this.ctx_mark,debug:this.debug,name:"ArrowLeft",img:e.left,x:i-h,y:s-h,start_degree:135,end_degree:225}),this.arrow_up=new yt({ctx:this.ctx_control,ctx_mark:this.ctx_mark,debug:this.debug,name:"ArrowUp",img:e.up,x:i,y:s-2*h,start_degree:225,end_degree:315}),this.button_fullscreen=new wt({ctx:this.ctx_control,ctx_mark:this.ctx_mark,debug:this.debug,name:"F11",img:e.full_screen,x:this.canvas_width-pt-ut,y:110}),this.button_pause=new wt({ctx:this.ctx_control,ctx_mark:this.ctx_mark,debug:this.debug,name:"Enter",img:e.pause,x:this.canvas_width-pt-ut,y:this.button_fullscreen.y+pt+xt}),this.button_power=new wt({ctx:this.ctx_control,ctx_mark:this.ctx_mark,debug:this.debug,name:"Control",img:e.power2,x:this.canvas_width-ut-pt,y:this.canvas_height-xt-ut-2*pt}),this.button_action=new wt({ctx:this.ctx_control,ctx_mark:this.ctx_mark,debug:this.debug,name:" ",img:e.power1,x:this.canvas_width-xt-ut-2*pt,y:this.canvas_height-ut-pt}),this.btn_gui_list=[this.button_pause,this.button_fullscreen],this.btn_control_list=[this.button_power,this.button_action],this.btn_list=[...this.btn_gui_list,...this.btn_control_list],this.arrow_list=[this.arrow_right,this.arrow_down,this.arrow_left,this.arrow_up]}resize(){this.canvas_rect=this.canvas_mark.getBoundingClientRect()}draw_gui(){this.btn_gui_list.forEach((t=>{t.draw(),t.draw_mark()}))}draw_fullscreen(){this.redraw_button({btn:this.button_fullscreen,img:e.full_screen}),this.button_fullscreen.draw_mark()}draw_normalscreen(){this.redraw_button({btn:this.button_fullscreen,img:e.normal_screen}),this.button_fullscreen.draw_mark()}draw_pause(){this.redraw_button({btn:this.button_pause,img:e.pause}),this.button_pause.draw_mark()}draw_start(){this.redraw_button({btn:this.button_pause,img:e.start}),this.button_pause.draw_mark()}draw_control(){this.btn_control_list.forEach((t=>{t.draw(),t.draw_mark()}))}draw_arrow(){this.arrow_list.forEach((t=>{t.draw(),t.draw_mark()}))}clear_gui(){this.btn_gui_list.forEach((t=>{t.clear(),t.clear_mark()}))}clear_fullscreen(){this.button_fullscreen.clear(),this.button_fullscreen.clear_mark()}clear_pause(){this.button_pause.clear(),this.button_pause.clear_mark()}clear_control(){this.btn_control_list.forEach((t=>{t.clear(),t.clear_mark()}))}clear_arrow(){this.arrow_list.forEach((t=>{t.clear(),t.clear_mark()}))}redraw_button(t){t.btn&&(t.img||t.color)&&(t.img&&(t.btn.img=new Image,t.btn.img.src=t.img),t.color&&(t.btn.color=t.color),t.btn.draw())}redraw_arrow(t){t.arr&&(t.img||t.color)&&(t.img&&(t.arr.img=new Image,t.arr.img.src=t.img),t.color&&(t.arr.color=t.color),t.arr.draw())}get_mouse_location(t,e){let i=0,s=0,h=0,a=0,r=t;do{i+=r.offsetLeft-r.scrollLeft,s+=r.offsetTop-r.scrollTop}while(r=r.offsetParent?r.offsetParent:null);h=e.pageX-i,a=e.pageY-s;const _=this.canvas_width/this.canvas_rect.width;return{x:h*_+.5*this.canvas_width,y:a*_+.5*this.canvas_height}}mouse_event(t){let{x:e,y:i}=this.get_mouse_location(this.canvas_mark,t.event);if(e>-1&&i>-1){t.debug&&(this.ctx_pointer.clearRect(l(e-50),l(i-50),100,100),this.ctx_pointer.fillStyle=`rgba(${p},0.5)`,this.ctx_pointer.fillRect(l(e-5),l(i-5),10,10),console.log({x:e,y:i}));const s=this.ctx_mark.getImageData(e,i,1,1).data;if(s&&s.length>3&&s[0]&&s[1]&&s[2]){if(s[0]>0&&s[1]>0&&s[2]>0){const e=this.btn_list.filter((t=>t.uid[0]===s[0]&&t.uid[1]===s[1]&&t.uid[2]===s[2]));if(e&&e.length>0&&e[0]){const i=e[0].name;"keydown"===t.event_name?this.redraw_button({btn:e[0],color:mt.click}):"keyup"===t.event_name&&this.redraw_button({btn:e[0],color:mt.normal}),window.dispatchEvent(new KeyboardEvent(t.event_name,{key:i}))}else{const e=this.arrow_list.filter((t=>t.uid[0]===s[0]&&t.uid[1]===s[1]&&t.uid[2]===s[2]));if(e&&e.length>0&&e[0]){const i=e[0].name;"keydown"===t.event_name?this.redraw_arrow({arr:e[0],color:mt.click}):"keyup"===t.event_name&&this.redraw_arrow({arr:e[0],color:mt.normal}),window.dispatchEvent(new KeyboardEvent(t.event_name,{key:i}))}}}}else 0===s[0]&&0===s[1]&&0===s[2]&&window.dispatchEvent(new KeyboardEvent(t.event_name,{key:" "}))}}attach_mouse(t){t.canvas_mark.addEventListener("mousedown",(e=>{this.mouse_event({event_name:"keydown",event:e,debug:t.debug})})),t.canvas_mark.addEventListener("mouseup",(e=>{this.mouse_event({event_name:"keyup",event:e,debug:t.debug})}))}last_touch_location={x:-1,y:-1};get_touch_location(t,e){if(e.touches&&e.touches.length>0&&e.touches[0]){let i=0,s=0,h=0,a=0,r=t;do{i+=r.offsetLeft-r.scrollLeft,s+=r.offsetTop-r.scrollTop}while(r=r.offsetParent?r.offsetParent:null);h=e.touches[0].pageX-i,a=e.touches[0].pageY-s;const _=this.canvas_width/this.canvas_rect.width,n=h*_+.5*this.canvas_width,l=a*_+.5*this.canvas_height;this.last_touch_location={x:n,y:l}}return this.last_touch_location}touch_event(t){let{x:e,y:i}=this.get_touch_location(this.canvas_mark,t.event);if(e>-1&&i>-1){t.debug&&(this.ctx_pointer.clearRect(l(e-50),l(i-50),100,100),this.ctx_pointer.fillStyle=`rgba(${p},0.5)`,this.ctx_pointer.fillRect(l(e-5),l(i-5),10,10));const s=this.ctx_mark.getImageData(e,i,1,1).data;if(s&&s.length>3&&s[0]&&s[1]&&s[2]){if(s[0]>0&&s[1]>0&&s[2]>0){const e=this.btn_list.filter((t=>t.uid[0]===s[0]&&t.uid[1]===s[1]&&t.uid[2]===s[2]));if(e&&e.length>0&&e[0]){const i=e[0].name;"keydown"===t.event_name?this.redraw_button({btn:e[0],color:mt.click}):"keyup"===t.event_name&&this.redraw_button({btn:e[0],color:mt.normal}),window.dispatchEvent(new KeyboardEvent(t.event_name,{key:i}))}else{const e=this.arrow_list.filter((t=>t.uid[0]===s[0]&&t.uid[1]===s[1]&&t.uid[2]===s[2]));if(e&&e.length>0&&e[0]){const i=e[0].name;"keydown"===t.event_name?this.redraw_arrow({arr:e[0],color:mt.click}):"keyup"===t.event_name&&this.redraw_arrow({arr:e[0],color:mt.normal}),window.dispatchEvent(new KeyboardEvent(t.event_name,{key:i}))}}}}else 0===s[0]&&0===s[1]&&0===s[2]&&window.dispatchEvent(new KeyboardEvent(t.event_name,{key:" "}))}}attach_touch(t){t.canvas_mark.addEventListener("touchstart",(e=>{this.touch_event({event_name:"keydown",event:e,debug:t.debug})})),t.canvas_mark.addEventListener("touchend",(e=>{this.touch_event({event_name:"keyup",event:e,debug:t.debug})}))}}class bt{ctx;img;img_width;img_height;x;y;width;height;debug;constructor(t){t.debug??=!1,this.debug=t.debug,this.ctx=t.ctx,this.img=new Image,this.img.src=t.img,this.img_width=t.img_width,this.img_height=t.img_height,this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}clear(){this.ctx.clearRect(l(this.x-1),l(this.y-1),this.width+2,this.height+2),this.debug&&this.ctx.strokeRect(l(this.x-1),l(this.y-1),this.width+2,this.height+2)}draw(){this.clear(),this.ctx.fillStyle=`rgb(${p})`,this.ctx.drawImage(this.img,0,0,this.img_width,this.img_height,l(this.x),l(this.y),this.width,this.height)}}class ft{debug;ctx;x;y;width;height;bg_color;shadow_color;shadow_blur;shadow_x;shadow_y;shadow_width;shadow_height;radius;constructor(t){t.height??=20,t.shadow_color??="#555555",t.shadow_blur??=1,t.bg_color??="#FFFFFF",t.radius??=5,t.debug??=!1,this.debug=t.debug,this.ctx=t.ctx,this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.radius=t.radius,this.bg_color=t.bg_color,this.shadow_color=t.shadow_color,this.shadow_blur=t.shadow_blur,this.shadow_x=this.x-this.shadow_blur,this.shadow_y=this.y-this.shadow_blur,this.shadow_width=this.width+2*this.shadow_blur,this.shadow_height=this.height+2*this.shadow_blur}clear(){this.shadow_color&&this.shadow_blur?this.ctx.clearRect(l(this.shadow_x-2),l(this.shadow_y-2),this.shadow_width+4,this.shadow_height+4):this.ctx.clearRect(l(this.x-1),l(this.y-1),this.width+2,this.height+2),this.debug&&(this.shadow_color&&this.shadow_blur?this.ctx.strokeRect(l(this.shadow_x-2),l(this.shadow_y-2),this.shadow_width+4,this.shadow_height+4):this.ctx.strokeRect(l(this.x-1),l(this.y-1),this.width+2,this.height+2))}draw(){this.clear(),this.ctx.save(),this.radius?(this.shadow_color&&this.shadow_blur&&(this.ctx.beginPath(),this.ctx.fillStyle=this.shadow_color,this.ctx.roundRect(l(this.shadow_x),l(this.shadow_y),this.shadow_width,this.shadow_height,[this.radius]),this.ctx.fill()),this.ctx.beginPath(),this.ctx.fillStyle=this.bg_color,this.ctx.roundRect(l(this.x),l(this.y),this.width,this.height,[this.radius]),this.ctx.fill()):(this.shadow_color&&this.shadow_blur&&(this.ctx.fillStyle=this.shadow_color,this.ctx.fillRect(l(this.shadow_x),l(this.shadow_y),this.shadow_width,this.shadow_height)),this.ctx.fillStyle=this.bg_color,this.ctx.fillRect(l(this.x),l(this.y),this.width,this.height)),this.ctx.restore()}}class kt{debug;ctx;x;y;text_value;text_align;font_weight;font_family;text_color;shadow_color;shadow_blur;constructor(t){t.font_family??="Creepster",t.font_weight??=20,t.text_color??=`rgb(${w})`,t.shadow_color??=`rgb(${y})`,t.shadow_blur??=2,t.text_align??="left",t.debug??=!1,this.debug=t.debug,this.ctx=t.ctx,this.x=t.x,this.y=t.y,this.text_value=t.text,this.text_align=t.text_align,this.font_weight=t.font_weight,this.font_family=t.font_family,this.text_color=t.text_color,this.shadow_color=t.shadow_color,this.shadow_blur=t.shadow_blur}clear(){k({debug:this.debug,ctx:this.ctx,x:this.x,y:this.y,text:this.text_value,text_align:this.text_align,font_weight:this.font_weight,font_family:this.font_family,shadow_blur:this.shadow_blur})}draw(){this.clear(),S({debug:this.debug,ctx:this.ctx,x:this.x,y:this.y,text:this.text_value,text_align:this.text_align,font_weight:this.font_weight,font_family:this.font_family,text_color:this.text_color,shadow_color:this.shadow_color,shadow_blur:this.shadow_blur})}}class Et{debug;ctx;canvas_width;canvas_height;progress=[];text=[];image=[];box=[];constructor(t){if(t.debug??=!1,this.debug=t.debug,this.ctx=t.ctx,this.canvas_width=t.canvas_width,this.canvas_height=t.canvas_height,this.image.push(new bt({ctx:this.ctx,img:e.icon,img_width:16,img_height:16,x:20,y:30,width:55,height:55,debug:this.debug})),this.image.push(new bt({ctx:this.ctx,img:e.life_icon,img_width:16,img_height:16,x:this.canvas_width-165,y:30,width:20,height:20,debug:this.debug})),this.image.push(new bt({ctx:this.ctx,img:e.power_icon,img_width:16,img_height:16,x:this.canvas_width-165,y:60,width:20,height:20,debug:this.debug})),this.text.push(new kt({ctx:this.ctx,x:l(this.canvas_width-5),y:l(this.canvas_height-5),text:"https://printf83.github.io/ts-game/",text_align:"right",font_family:"Arial",shadow_blur:0,text_color:`rgb(${w})`,font_weight:15,debug:this.debug})),this.debug){let t=120,e=0;const i=i=>new kt({ctx:this.ctx,x:20,y:t+25*e++,shadow_blur:0,text:i,text_color:`rgb(${x})`,font_family:"Arial",font_weight:20,debug:this.debug});this.text.push(i("FPS :")),this.text.push(i("Dust :")),this.text.push(i("Fire :")),this.text.push(i("Explosion :")),this.text.push(i("Enemy :")),this.text.push(i("Score :")),this.text.push(i("Random :"))}this.progress.push(new ft({ctx:this.ctx,x:.5*this.canvas_width-.4*this.canvas_width*.5,y:60,width:.4*this.canvas_width,debug:this.debug})),this.progress.push(new ft({ctx:this.ctx,x:this.canvas_width-130,y:30,width:100,debug:this.debug})),this.progress.push(new ft({ctx:this.ctx,x:this.canvas_width-130,y:60,width:100,debug:this.debug}))}draw(){[...this.text,...this.progress,...this.box,...this.image].forEach((t=>{t.draw()}))}}const St={enemy1:class extends I{life_index;life_length;constructor(t){const e=.1*d()+.3,i=293*e,s=155*e;super({...t,img:A,x:d()*(t.canvas_width-i)+.5*t.canvas_width,y:d()*(t.canvas_height-s),width:i,height:s,sprite_width:293,sprite_height:155,sprite_length:5,explode_in:!0,explode_out:!0,point:4}),this.life_index=0,this.life_length=5e3*d()+5e3}update(t){this.x+=7*d()-3.5,this.y+=7*d()-3.5,this.life_index+=t.delta_time,this.life_index>this.life_length&&(this.mark_delete=!0),super.update(t)}},enemy2:class extends I{move_speed;angle;angle_speed;curve;constructor(t){const e=.1*d()+.3,i=266*e,s=188*e;super({...t,img:T,x:t.canvas_width,y:d()*(t.canvas_height-s),width:i,height:s,sprite_width:266,sprite_height:188,sprite_length:5,have_particle:!0,point:3}),this.move_speed=4*d()+1,this.angle=2*d(),this.angle_speed=.2*d(),this.curve=5*d()}update(t){this.x-=this.move_speed,this.x<0-this.width&&(this.mark_delete=!0),this.y+=this.curve*Math.sin(this.angle),this.angle+=this.angle_speed,super.update(t)}},enemy3:class extends I{angle;angle_speed;life_index;life_length;constructor(t){const e=.1*d()+.3,i=218*e,s=177*e;super({...t,img:L,x:t.canvas_width,y:d()*(t.canvas_height-s),width:i,height:s,sprite_width:218,sprite_height:177,sprite_length:5,explode_out:!0,have_particle:!0,point:3}),this.angle=2*d(),this.angle_speed=.5*d()+.5,this.life_index=0,this.life_length=5e3*d()+5e3}update(t){this.x=this.canvas_width/2*Math.cos(this.angle*Math.PI/90)+(this.canvas_width/2-this.width/2),this.x+this.width<0&&(this.x=this.canvas_width),this.y=this.canvas_height/2*Math.sin(this.angle*Math.PI/270)+(this.canvas_height/2-this.height/2),this.y+this.height<0&&(this.y=this.canvas_height),this.angle+=this.angle_speed,this.life_index+=t.delta_time,this.life_index>this.life_length&&(this.mark_delete=!0),super.update(t)}},enemy4:class extends I{new_x;new_y;last_move;interval;life_index;life_length;constructor(t){const e=.1*d()+.3,i=213*e,s=213*e;super({...t,img:z,x:d()*(t.canvas_width-i)+.5*t.canvas_width,y:d()*(t.canvas_height-s),width:i,height:s,sprite_width:213,sprite_height:213,sprite_length:8,explode_in:!0,explode_out:!0,have_particle:!0,point:5}),this.new_x=d()*(t.canvas_width-i),this.new_y=d()*(t.canvas_height-s),this.last_move=0,this.interval=l(200*d()+50),this.life_index=0,this.life_length=5e3*d()+5e3}update(t){this.last_move%this.interval==0&&(this.last_move=0,this.new_x=d()*(this.canvas_width-this.width),this.new_y=d()*(this.canvas_height-this.height)),this.last_move++;let e=this.x-this.new_x,i=this.y-this.new_y;this.x-=e/20,this.y-=i/20,this.life_index+=t.delta_time,this.life_index>this.life_length&&(this.mark_delete=!0),super.update(t)}set_position(t){super.set_position(t),this.new_x-=t.game_speed,this.collision_x=this.x+this.collision_adjust_x+this.width*this.collision_scale}},enemy5:class extends I{direction_x;direction_y;constructor(t){const e=.1*d()+.3,i=271*e,s=194*e;super({...t,img:C,x:t.canvas_width,y:d()*(t.canvas_height-s),width:i,height:s,sprite_width:271,sprite_height:194,sprite_length:5,have_particle:!0,point:3}),this.direction_x=3*d()+1.5,this.direction_y=5*d()-2.5}update(t){this.x-=this.direction_x,this.y-=this.direction_y,this.x<0-this.width&&(this.mark_delete=!0),(this.y<0||this.y>this.canvas_height-this.height)&&(this.direction_y=-1*this.direction_y),super.update(t)}},enemy6:class extends I{speed;angle;curve;constructor(t){const e=.1*d()+.3,i=261*e,s=209*e;super({...t,img:F,x:t.canvas_width,y:d()*t.canvas_height*.5,width:i,height:s,sprite_width:261,sprite_height:209,sprite_length:5,point:4}),this.speed=2*d()+2,this.angle=0,this.curve=3*d()}update(t){this.x-=this.speed,this.y+=Math.sin(this.angle)*this.curve,this.angle+=.04,this.x<0-this.width&&(this.mark_delete=!0),super.update(t)}draw(){this.ctx.save(),this.ctx.globalAlpha=.5,super.draw(),this.ctx.restore()}},enemy7:class extends I{move_speed;constructor(t){const e=.1*d()+.3,i=229*e,s=171*e;super({...t,img:B,x:t.canvas_width+i,y:t.canvas_height-s,width:i,height:s,sprite_width:229,sprite_height:171,sprite_length:5,point:2}),this.move_speed=10*d()+5}update(t){this.x-=d()*this.move_speed,this.x<0-this.width&&(this.mark_delete=!0),super.update(t)}},enemy8:class extends I{destination_y;speed;string_x;string_y;constructor(t){const e=.1*d()+.3,i=310*e,s=175*e;super({...t,img:D,x:t.canvas_width+i,y:d()>.5?d()*(t.canvas_height-s):0-s,width:i,height:s,sprite_width:310,sprite_height:175,sprite_length:5,point:3}),this.destination_y=d()*(.8*(t.canvas_height-this.height)),this.speed=2*d()-4,this.y<this.destination_y&&(this.speed*=-1),this.string_x=this.x+.5*this.width,this.string_y=this.y+10}update(t){this.y+=this.speed,this.string_y=this.y+10,this.string_x=this.x+.5*this.width,this.y>this.destination_y&&this.speed>0&&(this.speed*=-1),this.y<0-this.height-5&&(this.mark_delete=!0),super.update(t)}draw(){this.ctx.beginPath(),this.ctx.moveTo(l(this.string_x),0),this.ctx.lineTo(l(this.string_x),l(this.string_y)),this.ctx.stroke(),super.draw()}set_position(t){super.set_position(t),this.string_x=this.x+.5*this.width,this.collision_x=this.x+this.collision_adjust_x+this.width*this.collision_scale}},enemy9:class extends I{move_speed;angle;angle_speed;curve;constructor(t){const e=.8*d()+1.1,i=60*e,s=44*e;super({...t,img:M,x:t.canvas_width,y:d()*(t.canvas_height-s),width:i,height:s,sprite_width:60,sprite_height:44,sprite_length:5,have_particle:!0,point:3}),this.move_speed=4*d()+1,this.angle=2*d(),this.angle_speed=.2*d(),this.curve=5*d()}update(t){this.x-=this.move_speed,this.x<0-this.width&&(this.mark_delete=!0),this.y+=this.curve*Math.sin(this.angle),this.angle+=this.angle_speed,super.update(t)}},enemy10:class extends I{constructor(t){const e=.75*d()+.95,i=60*e,s=87*e;super({...t,img:q,x:t.canvas_width+i,y:t.canvas_height-s,width:i,height:s,sprite_width:60,sprite_height:87,sprite_length:5,point:1})}},enemy11:class extends I{destination_y;speed;string_x;string_y;constructor(t){const e=.5*d()+.7,i=120*e,s=144*e;super({...t,img:K,x:t.canvas_width+i,y:d()>.5?d()*(t.canvas_height-s):0-s,width:i,height:s,sprite_width:120,sprite_height:144,sprite_length:5,point:3}),this.destination_y=d()*(.8*(t.canvas_height-this.height)),this.speed=2*d()-4,this.y<this.destination_y&&(this.speed*=-1),this.string_x=this.x+.5*this.width,this.string_y=this.y+50}update(t){this.y+=this.speed,this.string_y=this.y+50,this.string_x=this.x+.5*this.width,this.y>this.destination_y&&this.speed>0&&(this.speed*=-1),this.y<0-this.height-5&&(this.mark_delete=!0),super.update(t)}draw(){this.ctx.beginPath(),this.ctx.moveTo(l(this.string_x),0),this.ctx.lineTo(l(this.string_x),l(this.string_y)),this.ctx.stroke(),super.draw()}set_position(t){super.set_position(t),this.string_x=this.x+.5*this.width,this.collision_x=this.x+this.collision_adjust_x+this.width*this.collision_scale}}},Rt=["enemy1","enemy2","enemy3","enemy4","enemy5","enemy6","enemy7","enemy8","enemy9","enemy10","enemy11"];class $t{canvas_game;canvas_static;canvas_value;canvas_control;canvas_pointer;canvas_mark;ctx_game;ctx_static;ctx_value;ctx_control;ctx_pointer;ctx_mark;canvas_width;canvas_height;base_height;ctl;gui;bg;player;input;prg_game;prg_life;prg_power;enemy_list=[];explosion_list=[];dust_list=[];fire_list=[];score_list=[];progress_list=[];dust_max=50;fire_max=50;fps_min=30;debug=!1;game_up=!1;game_over=!1;game_timeout=!1;game_pause=!1;game_fps=0;game_fps_list=[];score_value=0;score_text="0";progress_index=0;progress_max=1e3;progress_timer=0;progress_timer_index=0;game_level=1;enemy_index=0;enemy_interval=0;enemy_interval_max=3e3;constructor(t){this.canvas_game=t.canvas_game,this.canvas_static=t.canvas_static,this.canvas_value=t.canvas_value,this.canvas_control=t.canvas_control,this.canvas_pointer=t.canvas_pointer,this.canvas_mark=t.canvas_mark,this.ctx_game=t.canvas_game.getContext("2d",{alpha:!1}),this.ctx_static=t.canvas_static.getContext("2d"),this.ctx_value=t.canvas_value.getContext("2d"),this.ctx_control=t.canvas_control.getContext("2d"),this.ctx_pointer=t.canvas_pointer.getContext("2d"),this.ctx_mark=t.canvas_mark.getContext("2d"),this.canvas_width=t.canvas_game.width,this.canvas_height=t.canvas_game.height,t.debug??=!1,this.debug=t.debug,this.input=new ct,this.ctl=new vt({canvas_control:this.canvas_control,canvas_mark:this.canvas_mark,canvas_pointer:this.canvas_pointer,ctx_control:this.ctx_control,ctx_mark:this.ctx_mark,ctx_pointer:this.ctx_pointer,canvas_width:this.canvas_width,canvas_height:this.canvas_height,debug:this.debug}),this.gui=new Et({ctx:this.ctx_static,canvas_width:this.canvas_width,canvas_height:this.canvas_height,debug:this.debug}),this.bg=new P({ctx:this.ctx_game,canvas_width:this.canvas_width,canvas_height:this.canvas_height}),this.base_height=this.canvas_height-this.bg.ground,this.player=new lt({game:this,ctx:this.ctx_game,canvas_width:this.canvas_width,canvas_height:this.base_height,x:v()?.25*this.canvas_width:.1*this.canvas_width,debug:this.debug}),this.prg_game=new ot({ctx:this.ctx_value,x:.5*this.canvas_width-.4*this.canvas_width*.5,y:60,min:0,max:this.progress_max,width:.4*this.canvas_width,value:this.progress_index,bar_color:[`rgb(${p})`,`rgb(${x})`,`rgb(${u})`]}),this.prg_life=new ot({ctx:this.ctx_value,x:this.canvas_width-130,y:30,width:100,value:this.player.life,max:100,bar_color:[`rgb(${p})`,`rgb(${x})`,`rgb(${u})`]}),this.prg_power=new ot({ctx:this.ctx_value,x:this.canvas_width-130,y:60,width:100,value:this.player.power,max:100,bar_color:[`rgb(${p})`,`rgb(${x})`,`rgb(${u})`]}),window.addEventListener("keyup",this.game_halt_listener),this.draw_gui()}draw_gui(){requestIdleCallback((()=>{this.gui.draw(),this.ctl.draw_gui(),v()?(this.ctl.draw_control(),this.ctl.draw_arrow(),this.ctl.attach_touch({canvas_mark:this.canvas_mark,marker_ctx:this.ctx_mark,pointer_ctx:this.ctx_pointer,control_ctx:this.ctx_control,debug:this.debug})):(this.debug&&(this.ctl.draw_control(),this.ctl.draw_arrow()),this.ctl.attach_mouse({canvas_mark:this.canvas_mark,marker_ctx:this.ctx_mark,pointer_ctx:this.ctx_pointer,control_ctx:this.ctx_control,debug:this.debug}))}))}resize(){this.ctl.resize()}gen_enemy_interval(){return this.enemy_interval_max-10*this.game_level}game_start(){this.game_level=1,this.progress_index=0,this.progress_max=1e3,this.progress_timer=performance.now()+6e4,this.progress_timer_index=60,this.enemy_index=0;let t=this.gen_enemy_interval();this.enemy_interval=d()*t+t,this.enemy_list=[],this.explosion_list=[],this.dust_list=[],this.fire_list=[],this.score_list=[],this.player.set_state("idle"),this.player.life=100,this.player.power=0,this.player.speed=0,this.player.max_speed=14+this.game_level,this.player.weight=1,this.player.velocity_y=0,this.player.y=this.base_height-this.player.height,this.player.powered=!1,this.player.invulnerable=!1,this.score_value=0,this.score_text="0",this.ctl.draw_pause(),(v()||this.debug)&&(this.ctl.draw_control(),this.ctl.draw_arrow()),this.game_over=!1,this.game_timeout=!1,this.clean_ctx_value_message(),requestAnimationFrame((t=>{this.animate(t)}))}game_level_up(){this.game_level++,this.progress_index=0,this.progress_max=1e3+100*this.game_level,this.progress_timer=performance.now()+6e4,this.progress_timer_index=60,this.enemy_index=0;let t=this.gen_enemy_interval();this.enemy_interval=d()*t+t,this.enemy_list=[],this.explosion_list=[],this.dust_list=[],this.fire_list=[],this.player.set_state("idle"),this.player.life+=10,this.player.life>100&&(this.player.life=100),this.player.speed=0,this.player.max_speed=14+this.game_level,this.player.weight=1,this.player.velocity_y=0,this.player.y=this.base_height-this.player.height,this.player.powered=!1,this.player.invulnerable=!1,this.ctl.draw_pause(),(v()||this.debug)&&(this.ctl.draw_control(),this.ctl.draw_arrow()),this.game_up=!1,this.clean_ctx_value_message(),requestAnimationFrame((t=>{this.animate(t)}))}game_continue(){this.progress_timer=performance.now()+1e3*this.progress_timer_index,this.ctl.draw_pause(),(v()||this.debug)&&(this.ctl.draw_control(),this.ctl.draw_arrow()),this.game_pause=!1,this.clean_ctx_value_message(),requestAnimationFrame((t=>{this.animate(t)}))}add_explosion(t,e){this.explosion_list.push(new O({ctx:this.ctx_game,x:t.x+.5*t.width,y:t.y+.5*t.height,scale:.008*t.width,play_sound:e}))}add_floating_score(t,e){let i=l(.1*(100-t.y/(t.canvas_height-t.height+this.base_height)*100)*t.point);e&&i>0&&(i*=-1),!e&&i<0&&(i*=-1),this.score_list.push(new dt({ctx:this.ctx_game,text:`${i>0?"+":""}${i}`,value:i,x:t.x+.5*t.width,y:t.y+.5*t.height,destination_x:90,destination_y:60}))}collision_detection(){this.enemy_list.forEach((t=>{t.mark_delete||t.is_collide({player:this.player})&&(this.player.is_powered()?(t.explode_out=!1,this.add_explosion(t,!0),this.add_floating_score(t,!1),t.mark_delete=!0):(this.player.invulnerable||(this.player.life>30?(this.player.life-=10,this.player.set_state("gethit")):this.player.life>0?(this.player.life-=10,this.player.set_state("dizzy")):(this.player.set_state("ko"),setTimeout((()=>{this.ctl.clear_control(),this.ctl.clear_arrow(),this.ctl.draw_start(),this.game_over=!0}),500))),this.game_over||this.game_timeout||(t.explode_out=!1,this.add_explosion(t,!1),this.add_floating_score(t,!0),t.mark_delete=!0)))}))}last_draw_message_title="";last_draw_message_message="";draw_message(t,e,i){this.last_draw_message_title=t,this.last_draw_message_message=e,this.debug&&this.clear_message(t,e),S({ctx:this.ctx_value,x:.5*this.canvas_width,y:.5*this.base_height-20,text:t,font_weight:60,text_align:"center",text_color:i,debug:this.debug}),S({ctx:this.ctx_value,x:.5*this.canvas_width,y:.5*this.base_height+20,text:e,font_weight:30,text_align:"center",text_color:i,debug:this.debug})}clear_message(t,e){k({ctx:this.ctx_value,x:.5*this.canvas_width,y:.5*this.base_height-20,text:t,font_weight:60,text_align:"center",debug:this.debug}),k({ctx:this.ctx_value,x:.5*this.canvas_width,y:.5*this.base_height+20,text:e,font_weight:30,text_align:"center",debug:this.debug})}clean_ctx_value_message(){this.clear_message(this.last_draw_message_title,this.last_draw_message_message)}draw_status(){E({ctx:this.ctx_value,x:90,y:80,text:`${this.score_text}`,text_color:this.score_value<0?`rgb(${p})`:`rgb(${w})`,font_weight:60,debug:this.debug}),E({ctx:this.ctx_value,x:.5*(this.canvas_width-this.prg_game.width),y:50,text:`Level ${this.game_level}`,text_align:"start",font_weight:25,debug:this.debug}),E({ctx:this.ctx_value,x:.5*(this.canvas_width+this.prg_game.width),y:50,text:`0:${this.progress_timer_index.toString().padStart(2,"0")}`,text_align:"end",text_color:this.progress_timer_index<20?`rgb(${p})`:`rgb(${w})`,font_weight:25,debug:this.debug}),this.prg_game.update(this.progress_index,0,this.progress_max),this.prg_life.update(this.player.life),this.prg_power.update(this.player.power),[this.prg_game,this.prg_life,this.prg_power].forEach((t=>t.draw())),this.game_over&&this.draw_message("Game over!",v()?"Press START to try again.":"Press START/ENTER to try again.",`rgb(${p})`),this.game_timeout&&this.draw_message("Time up!",v()?"Press START to try again.":"Press START/ENTER to try again.",`rgb(${p})`),this.game_up&&this.draw_message(`Level ${this.game_level} complete!`,v()?"Press START to continue.":"Press START/ENTER to continue.",`rgb(${u})`),this.game_pause&&this.draw_message("Pause!",v()?"Press START to continue.":"Press START/ENTER to continue.",`rgb(${w})`)}last_timestamp=0;update(t){const e=t-this.last_timestamp;if(this.last_timestamp=t,this.progress_index+=.1*this.player.speed,this.progress_index>=this.progress_max&&(this.ctl.clear_control(),this.ctl.clear_arrow(),this.ctl.draw_start(),this.game_up=!0),this.progress_timer_index=l(.001*(this.progress_timer-t)),this.progress_timer_index<=0&&(this.ctl.clear_control(),this.ctl.clear_arrow(),this.ctl.draw_start(),this.game_timeout=!0),this.player.power+=.1,this.player.power>100&&(this.player.power=100),this.bg.update({game_speed:this.player.speed}),this.player.update_input(this.input),this.player.update({delta_time:e}),this.player.speed===this.player.max_speed&&Array(3).fill(0).forEach((t=>{this.fire_list.unshift(new X({ctx:this.ctx_game,x:this.player.x-40+10*d()-10,y:this.player.y+25+10*d()-10}))})),this.enemy_index>=this.enemy_interval){const t=Rt[l(d()*Rt.length)],e=new(0,St[t])({ctx:this.ctx_game,canvas_width:this.canvas_width,canvas_height:this.base_height,debug:this.debug});e.explode_in&&this.explosion_list.push(new O({ctx:this.ctx_game,x:e.x+.5*e.width,y:e.y+.5*e.height,scale:e.width/e.sprite_width*1.5,play_sound:!1})),this.enemy_list.push(e),this.enemy_list.sort(((t,e)=>t.width-e.width));let i=this.gen_enemy_interval();this.enemy_interval=d()*i+i,this.enemy_index=0}else this.enemy_index+=e;[...this.fire_list,...this.dust_list,...this.explosion_list].forEach((t=>{t.update({delta_time:e}),t.set_position({game_speed:this.player.speed})})),this.score_list.forEach((t=>{t.update(),t.mark_delete&&(this.score_value+=t.value,this.score_text=this.score_value.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))})),this.enemy_list.forEach((t=>{t.update({delta_time:e}),t.set_position({game_speed:this.player.speed}),t.x<0-t.width?t.mark_delete=!0:t.mark_delete&&t.explode_out&&this.add_explosion(t,!1),t.have_particle&&this.dust_list.unshift(new gt({ctx:this.ctx_game,x:t.x+.5*t.width+50*d()-25,y:t.y+.5*t.height+30*d()-15,color:`rgba(${t.uid_number},0.2)`}))})),this.collision_detection(),this.score_list=this.score_list.filter((t=>!t.mark_delete)),this.dust_list=this.dust_list.filter((t=>!t.mark_delete)),this.fire_list=this.fire_list.filter((t=>!t.mark_delete)),this.explosion_list=this.explosion_list.filter((t=>!t.mark_delete)),this.enemy_list=this.enemy_list.filter((t=>!t.mark_delete)),this.dust_list.length>this.dust_max&&(this.dust_list=this.dust_list.slice(0,this.dust_max)),this.fire_list.length>this.fire_max&&(this.fire_list=this.fire_list.slice(0,this.fire_max))}draw(){[this.bg,...this.fire_list,...this.dust_list,...this.score_list,...this.enemy_list,this.player,...this.explosion_list].forEach((t=>{t.draw()}))}game_halt_listener=t=>{if("Enter"===t.key)t.preventDefault(),t.stopPropagation(),this.game_up||this.game_over||this.game_timeout||this.game_pause?((this.game_over||this.game_timeout)&&this.game_start(),this.game_up&&this.game_level_up(),this.game_pause&&this.game_continue()):(this.ctl.clear_control(),this.ctl.clear_arrow(),this.ctl.draw_start(),this.game_pause=!0);else if("F11"===t.key)if(t.preventDefault(),t.stopPropagation(),b())document.exitFullscreen().then((()=>{b()||this.ctl.draw_fullscreen()})).catch((t=>{console.log(t)}));else{this.canvas_game.parentElement.requestFullscreen({navigationUI:"hide"}).then((()=>{b()&&this.ctl.draw_normalscreen()})).catch((t=>{console.log(t)}))}};is_enough_fps(t,e){const i=t-1e3;this.game_fps_list.length>this.fps_min&&(this.game_fps_list=this.game_fps_list.filter((t=>t>i))),this.game_fps_list.push(t),this.game_fps=this.game_fps_list.length,this.game_fps>=this.fps_min?e(t):requestAnimationFrame((t=>{this.is_enough_fps(t,e)}))}debug_info(){let t=0;const e=(e,i,s)=>{E({ctx:this.ctx_value,x:e,y:120+25*t++,shadow_blur:0,text:i,text_color:s||`rgb(${x})`,font_family:"Arial",font_weight:20,debug:this.debug})};e(78,`${this.game_fps}`,this.game_fps<30?`rgb(${p})`:`rgb(${x})`),e(80,`${this.dust_list.length}`),e(73,`${this.fire_list.length}`),e(125,`${this.explosion_list.length}`),e(100,`${this.enemy_list.length}`),e(90,`${this.score_list.length}`),e(115,`${o}`)}do_animate=t=>{this.update(t),this.draw(),this.draw_status(),this.debug&&this.debug_info(),this.game_over||this.game_timeout||this.game_pause||this.game_up||requestAnimationFrame((t=>{this.animate(t)}))};animate(t){this.debug?this.is_enough_fps(t,this.do_animate):this.do_animate(t)}}const Pt=document.getElementById("gameCanvas"),jt=document.getElementById("guiCanvas"),It=document.getElementById("valueCanvas"),At=document.getElementById("controlCanvas"),Tt=document.getElementById("pointerCanvas"),Lt=document.getElementById("markerCanvas");window.addEventListener("load",(()=>{if(Pt&&jt&&It&&At&&Tt&&Lt){[Pt,jt,It,At,Tt,Lt].forEach((t=>{t.width=1300,t.height=700})),Lt.classList.add("hide"),Tt.classList.add("hide");const t=new $t({canvas_game:Pt,canvas_static:jt,canvas_value:It,canvas_control:At,canvas_pointer:Tt,canvas_mark:Lt,debug:!1});setTimeout((()=>{t.game_start()}),1e3),window.addEventListener("resize",(()=>{t.resize()}))}else console.error("gameCanvas not found")}))})();