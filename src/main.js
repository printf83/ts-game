(()=>{"use strict";const t=2*Math.PI,e=t=>t+(t<0?-1:0)>>0;let s=0;const i=Array(32e3).fill(0).map((t=>Math.random())),h=()=>++s>=32e3?i[s=0]:i[s],a=()=>Array(3).fill("").map((t=>e(255*h()))),r=t=>{t.font_family??="Creepster",t.font_weight??=20,t.text_color??="white",t.shadow_color??="black",t.shadow_blur??=2,t.text_align??="left",t.ctx.save(),t.ctx.textAlign=t.text_align,t.ctx.font=`${t.font_weight}px ${t.font_family}`,t.ctx.fillStyle=t.shadow_color,t.ctx.fillText(t.text,e(t.x+t.shadow_blur),e(t.y+t.shadow_blur)),t.ctx.fillStyle=t.text_color,t.ctx.fillText(t.text,e(t.x),e(t.y)),t.ctx.restore()};class n{img;x;y;width;height;ratio;canvas_width;canvas_height;x2;speed_modifier;constructor(t){this.img=t.img,this.x=0,this.y=0,this.width=t.width,this.height=t.height,this.canvas_height=t.canvas_height,this.ratio=this.width/this.height,this.canvas_width=this.canvas_height*this.ratio,this.speed_modifier=t.speed_modifier,this.x2=this.x+this.width}update(t){this.x-=t*this.speed_modifier,this.x<0-this.width&&(this.x=0),this.x2=this.x+this.width-t-1}draw(t){t.drawImage(this.img,e(this.x),e(this.y),this.width,this.height),t.drawImage(this.img,e(this.x2),e(this.y),this.width,this.height)}}class l{width;height;ground;canvas_width;canvas_height;img_setup=t=>{const e=new Image;return e.src=t,e};bg_list=[];constructor(t){this.width=t.width,this.height=t.height,this.ground=t.ground,this.canvas_width=t.canvas_width,this.canvas_height=t.canvas_height,t.img.forEach((t=>{this.bg_list.push(new n({img:this.img_setup(t.url),canvas_height:this.canvas_height,width:this.width,height:this.height,speed_modifier:t.speed_modifier}))}))}update=t=>{this.bg_list.forEach((e=>{e.update(t.game_speed)}))};draw=t=>{this.bg_list.forEach((e=>{e.draw(t.ctx)}))}}class _ extends l{constructor(t){super({img:[{url:"./res/bg2/layer-1.png",speed_modifier:.2},{url:"./res/bg2/layer-2.png",speed_modifier:.4},{url:"./res/bg2/layer-3.png",speed_modifier:.6},{url:"./res/bg2/layer-4.png",speed_modifier:.8},{url:"./res/bg2/layer-5.png",speed_modifier:1}],canvas_width:t.canvas_width,canvas_height:t.canvas_height,width:2400,height:700,ground:50})}}class o{fps;frame;frame_timer;frame_interval;frame_y;frame_x;mark_delete;img;x;y;width;height;sprite_width;sprite_height;sprite_length;animation_repeat;constructor(t){t.fps??=20,t.animation_repeat??=!0,this.fps=t.fps,this.frame=0,this.frame_timer=0,this.frame_interval=1e3/this.fps,this.frame_y=0,this.frame_x=0,this.mark_delete=!1,this.img=t.img,this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.sprite_length=t.sprite_length,this.sprite_width=t.sprite_width,this.sprite_height=t.sprite_height,this.animation_repeat=t.animation_repeat}update(t){this.frame_timer>=this.frame_interval?(this.frame_timer=0,this.frame>=this.sprite_length?this.animation_repeat?this.frame=0:!this.animation_repeat&&t.onframecomplete?t.onframecomplete():this.mark_delete=!0:(this.frame++,this.frame_x=this.frame*this.sprite_width,t.onframechange&&t.onframechange())):this.frame_timer+=t.delta_time}draw(t){t.ctx.drawImage(this.img,this.frame_x,this.frame_y,this.sprite_width,this.sprite_height,e(this.x),e(this.y),this.width,this.height)}set_position(t){this.x-=t.game_speed,this.x<0-this.width&&(this.mark_delete=!0)}}class d extends o{debug=!1;uid;uid_text;uid_number;canvas_width;canvas_height;point;explode_in;explode_out;have_particle;collision_x;collision_y;collision_adjust_x;collision_adjust_y;collision_scale;constructor(t){super(t),t.debug??=!1,t.explode_in??=!1,t.explode_out??=!1,t.have_particle??=!1,t.point??=1,t.collision_scale??=.5,t.collision_x??=0,t.collision_y??=0,this.debug=t.debug,this.uid=a(),this.uid_number=`${this.uid[0]},${this.uid[1]},${this.uid[2]}`,this.uid_text=`rgb(${this.uid[0]},${this.uid[1]},${this.uid[2]})`,this.canvas_width=t.canvas_width,this.canvas_height=t.canvas_height,this.explode_in=t.explode_in,this.explode_out=t.explode_out,this.have_particle=t.have_particle,this.point=t.point,this.collision_scale=t.collision_scale,this.collision_adjust_x=t.collision_x,this.collision_adjust_y=t.collision_y,this.collision_x=this.x+this.collision_adjust_x+this.width*this.collision_scale,this.collision_y=this.y+this.collision_adjust_y+this.height*this.collision_scale}update(t){super.update(t),this.collision_x=this.x+this.collision_adjust_x+this.width*this.collision_scale,this.collision_y=this.y+this.collision_adjust_y+this.height*this.collision_scale}draw(s){s.ctx_collision&&(s.ctx_collision.fillStyle=this.uid_text,s.ctx_collision.fillRect(e(this.x),e(this.y),this.width,this.height)),super.draw(s),this.debug&&(s.ctx.save(),s.ctx.strokeStyle="white",s.ctx.beginPath(),s.ctx.arc(this.collision_x,this.collision_y,100*this.collision_scale,0,t),s.ctx.stroke(),s.ctx.restore())}set_position(t){super.set_position(t),this.collision_x=this.x+this.collision_adjust_x+this.width*this.collision_scale}is_collide(t){const e=this.collision_x-t.player.collision_x,s=this.collision_y-t.player.collision_y;return Math.sqrt(e*e+s*s)<this.width*this.collision_scale+t.player.width*t.player.collision_scale}}const c=new Image;c.src="./res/enemy/enemy1.png";const p=new Image;p.src="./res/enemy/enemy2.png";const g=new Image;g.src="./res/enemy/enemy3.png";const u=new Image;u.src="./res/enemy/enemy4.png";const y=new Image;y.src="./res/enemy/enemy5.png";const x=new Image;x.src="./res/enemy/enemy6.png";const m=new Image;m.src="./res/enemy/enemy7.png";const w=new Image;w.src="./res/enemy/enemy8.png";const v=new Image;v.src="./res/enemy/enemy9.png";const f=new Image;f.src="./res/enemy/enemy10.png";const b=new Image;b.src="./res/enemy/enemy11.png";const k=new Image;k.src="./res/boom.png";class E extends o{sound_played;sound;angle;dx;dy;sx;constructor(t){const e=200*t.scale,s=179*t.scale;super({img:k,x:t.x,y:t.y,width:e,height:s,sprite_width:200,sprite_height:179,sprite_length:5,fps:30,animation_repeat:!1}),t.play_sound??=!0,t.play_sound&&(this.sound_played=!1,this.sound="./res/boom.wav"),this.angle=180*h(),this.dx=0-.5*this.width,this.dy=0-.5*this.height,this.sx=0}update(t){this.sound&&!this.sound_played&&(this.sound_played=!0,new Audio(this.sound).play()),super.update({delta_time:t.delta_time,onframechange:()=>{this.sx=this.sprite_width*this.frame}})}draw(t){t.ctx.save(),t.ctx.translate(this.x,this.y),t.ctx.rotate(this.angle),t.ctx.drawImage(this.img,e(this.sx),0,this.sprite_width,this.sprite_width,this.dx,this.dy,this.width,this.height),t.ctx.restore()}}class S{x;y;speed_x;speed_y;size;mark_delete;constructor(t){t.speed_x??=h(),t.speed_y??=h(),t.size??=10*h()+10,this.x=t.x,this.y=t.y,this.speed_x=t.speed_x,this.speed_y=t.speed_y,this.size=t.size,this.mark_delete=!1}update(){this.x-=this.speed_x,this.y-=this.speed_y,this.size*=.97,this.size<.5&&(this.mark_delete=!0)}set_position(t){this.x-=t.game_speed,this.x<0-this.size&&(this.mark_delete=!0)}}const R=new Image;R.src="./res/fire.png";class j extends S{img;img_size;constructor(t){super({x:t.x,y:t.y,size:100*h()+50}),this.img=R,this.img_size=.5*-this.size}update(){super.update(),this.img_size=.5*-this.size}draw(t){t.ctx.drawImage(this.img,e(this.x),e(this.y),this.size,this.size)}}const C={idle:{frame_y:0,sprite_length:7,animation_repeat:!0,collision_adjust_x:0,collision_adjust_y:0},jump:{frame_y:1,sprite_length:7,animation_repeat:!0,collision_adjust_x:0,collision_adjust_y:0},fall:{frame_y:2,sprite_length:7,animation_repeat:!0,collision_adjust_x:0,collision_adjust_y:0},run:{frame_y:3,sprite_length:8,animation_repeat:!0,collision_adjust_x:0,collision_adjust_y:0},dizzy:{frame_y:4,sprite_length:11,animation_repeat:!1,collision_adjust_x:0,collision_adjust_y:0},sit:{frame_y:5,sprite_length:5,animation_repeat:!0,collision_adjust_x:0,collision_adjust_y:15},roll:{frame_y:6,sprite_length:7,animation_repeat:!0,collision_adjust_x:-2,collision_adjust_y:22},jump_roll:{frame_y:6,sprite_length:7,animation_repeat:!0,collision_adjust_x:-2,collision_adjust_y:22},fall_roll:{frame_y:6,sprite_length:7,animation_repeat:!0,collision_adjust_x:-2,collision_adjust_y:22},power_fall:{frame_y:6,sprite_length:7,animation_repeat:!0,collision_adjust_x:-2,collision_adjust_y:22},bite:{frame_y:7,sprite_length:7,animation_repeat:!1,collision_adjust_x:15,collision_adjust_y:8},ko:{frame_y:8,sprite_length:12,animation_repeat:!1,collision_adjust_x:0,collision_adjust_y:30},gethit:{frame_y:9,sprite_length:4,animation_repeat:!1,collision_adjust_x:0,collision_adjust_y:0}};class A{current_state;player;constructor(t,e){this.current_state=t,this.player=e}enter(){this.player.frame=0,this.player.frame_x=0,this.player.collision_adjust_x=C[this.current_state].collision_adjust_x,this.player.collision_adjust_y=C[this.current_state].collision_adjust_y,this.player.frame_y=C[this.current_state].frame_y*this.player.sprite_height,this.player.sprite_length=C[this.current_state].sprite_length-1,this.player.animation_repeat=C[this.current_state].animation_repeat}update(){}handle_input(t){}animation_end(t){}}class P extends A{constructor(t){super("idle",t)}enter(){super.enter(),this.player.speed=0}handle_input(t){"PRESS right"===t.last_key&&this.player.set_state("run"),"PRESS up"===t.last_key&&this.player.set_state("jump"),"PRESS down"===t.last_key&&this.player.set_state("sit"),"PRESS space"===t.last_key&&this.player.set_state("bite")}}class L extends A{constructor(t){super("jump",t)}enter(){super.enter(),this.player.is_ground()&&(this.player.weight=1,this.player.velocity_y-=32)}update(){super.update(),this.player.velocity_y>0&&this.player.set_state("fall")}handle_input(t){"PRESS down"===t.last_key&&(this.player.velocity_y=0,this.player.set_state("fall")),"PRESS right"===t.last_key&&this.player.power>10&&this.player.set_state("jump_roll")}}class I extends A{constructor(t){super("fall",t)}enter(){super.enter()}update(){super.update(),this.player.is_ground()&&(this.player.speed>0?this.player.set_state("run"):this.player.set_state("idle"))}handle_input(t){"PRESS right"===t.last_key&&this.player.power>10&&this.player.set_state("fall_roll"),"PRESS down"===t.last_key&&this.player.power>10&&this.player.set_state("power_fall")}}class $ extends A{constructor(t){super("power_fall",t)}enter(){super.enter(),this.player.weight=20,this.player.speed=this.player.max_speed}update(){super.update(),this.player.power--,this.player.is_ground()?(this.player.speed=.5*this.player.max_speed,this.player.set_state("run")):this.player.power<=0&&(this.player.weight=1,this.player.speed=.5*this.player.max_speed,this.player.set_state("fall"))}handle_input(t){"RELESE down"===t.last_key&&(this.player.speed=.5*this.player.max_speed,this.player.set_state("fall"))}}class M extends A{constructor(t){super("run",t)}enter(){super.enter(),this.player.speed=.5*this.player.max_speed}handle_input(t){"PRESS left"===t.last_key&&this.player.set_state("idle"),"PRESS right"===t.last_key&&this.player.power>10&&this.player.set_state("roll"),"PRESS down"===t.last_key&&this.player.set_state("sit"),"PRESS up"===t.last_key&&this.player.set_state("jump"),"PRESS space"===t.last_key&&this.player.set_state("bite")}}class z extends A{constructor(t){super("dizzy",t)}enter(){super.enter(),this.player.speed=0,this.player.invulnerable=!0}animation_end(t){setTimeout((()=>{t.invulnerable=!1}),300),t.set_state("idle")}}class F extends A{constructor(t){super("sit",t)}enter(){super.enter(),this.player.invulnerable=!0,this.player.speed=0}update(){super.update(),this.player.power+=.5}handle_input(t){"RELEASE down"===t.last_key&&(this.player.invulnerable=!1,this.player.set_state("idle"))}}class T extends A{constructor(t){super("roll",t)}enter(){super.enter(),this.player.speed=this.player.max_speed}update(){super.update(),this.player.power--,this.player.power<0&&(this.player.power=0,this.player.set_state("run"))}handle_input(t){"RELEASE right"===t.last_key&&this.player.set_state("run"),"RELEASE down"===t.last_key&&this.player.set_state("run"),"PRESS up"===t.last_key&&this.player.power>10&&this.player.set_state("jump_roll"),"PRESS left"===t.last_key&&this.player.set_state("idle"),"PRESS down"===t.last_key&&this.player.set_state("sit")}}class D extends A{constructor(t){super("jump_roll",t)}enter(){super.enter(),this.player.speed=this.player.max_speed}update(){super.update(),this.player.power--,this.player.velocity_y>0?this.player.power<=0?(this.player.speed=.5*this.player.max_speed,this.player.set_state("fall")):this.player.set_state("fall_roll"):this.player.power<=0&&(this.player.speed=.5*this.player.max_speed,this.player.set_state("jump"))}handle_input(t){"RELEASE right"===t.last_key&&(this.player.speed=.5*this.player.max_speed,this.player.velocity_y>0?this.player.set_state("fall"):this.player.set_state("jump"))}}class B extends A{constructor(t){super("fall_roll",t)}enter(){super.enter(),this.player.speed=this.player.max_speed}update(){super.update(),this.player.is_ground()?this.player.set_state("roll"):(this.player.power--,this.player.power<=0&&(this.player.speed=.5*this.player.max_speed,this.player.set_state("fall")))}handle_input(t){"RELEASE right"===t.last_key&&(this.player.speed=.5*this.player.max_speed,this.player.set_state("fall"))}}class q extends A{constructor(t){super("bite",t)}enter(){super.enter(),this.player.powered=!0,this.player.invulnerable=!0,this.player.speed=0}animation_end(t){setTimeout((()=>{t.powered=!1,t.invulnerable=!1}),300),t.set_state("idle")}}class U extends A{constructor(t){super("ko",t)}enter(){super.enter(),this.player.weight=20,this.player.invulnerable=!0,this.player.speed=0}}class O extends A{constructor(t){super("gethit",t)}enter(){super.enter(),this.player.invulnerable=!0,this.player.speed=0}animation_end(t){setTimeout((()=>{t.invulnerable=!1}),300),t.set_state("idle")}}class G extends o{debug=!1;state_list={};current_state;canvas_width;canvas_height;invulnerable;powered;power;speed;life;max_speed;velocity_y;weight;collision_scale=.5;collision_adjust_x=0;collision_adjust_y=0;collision_x;collision_y;constructor(t){const e=new Image;e.src="./res/player.png";const s=130.75;super({img:e,x:.1*t.canvas_width,y:t.canvas_height-s,width:143.75,height:s,sprite_width:575,sprite_height:523,sprite_length:0}),t.debug??=!1,this.debug=t.debug,this.canvas_width=t.canvas_width,this.canvas_height=t.canvas_height,this.collision_x=this.x+this.collision_adjust_x+this.width*this.collision_scale,this.collision_y=this.y+this.collision_adjust_y+this.height*this.collision_scale,this.velocity_y=0,this.weight=1,this.speed=0,this.life=100,this.max_speed=14,this.power=100,this.powered=!1,this.invulnerable=!1,this.state_list={idle:new P(this),jump:new L(this),fall:new I(this),power_fall:new $(this),run:new M(this),dizzy:new z(this),sit:new F(this),roll:new T(this),jump_roll:new D(this),fall_roll:new B(this),bite:new q(this),ko:new U(this),gethit:new O(this)},this.current_state=this.state_list.idle}update_input(t){this.current_state?.handle_input(t)}is_ground(){return this.y>=this.canvas_height-this.height}is_powered(){return this.powered||this.speed===this.max_speed}set_state=t=>{this.current_state=this.state_list[t],this.current_state?.enter()};update(t){this.y+=this.velocity_y,this.is_ground()?this.velocity_y=0:this.velocity_y+=this.weight,this.y>this.canvas_height-this.height&&(this.y=this.canvas_height-this.height),this.power+=.1,this.power>100&&(this.power=100),this.power<0&&(this.power=0),this.current_state?.update(),super.update({delta_time:t.delta_time,onframecomplete:()=>{this.current_state?.animation_end(this)}}),this.collision_x=this.x+this.collision_adjust_x+this.width*this.collision_scale,this.collision_y=this.y+this.collision_adjust_y+this.height*this.collision_scale}draw(e){super.draw(e),this.debug&&(e.ctx.save(),e.ctx.strokeStyle="white",e.ctx.beginPath(),e.ctx.arc(this.collision_x,this.collision_y,100*this.collision_scale,0,t),e.ctx.stroke(),e.ctx.restore())}}class K{x;y;min;max;width;height;value;percent;bar_color;bar_x;bar_y;bar_width;bar_max_width;bar_height;radius;padding;constructor(t){t.shadow_color??="#555555",t.shadow_blur??=1,t.bg_color??="#FFFFFF",t.bar_color??="#555555",t.radius??=5,t.padding??=2,t.min??=0,t.max??=1e3,t.height??=20,t.value??=0,this.x=t.x,this.y=t.y,this.min=t.min,this.max=t.max,this.width=t.width,this.height=t.height,this.value=t.value,this.percent=this.value/this.max,this.radius=t.radius,this.padding=t.padding,this.bar_x=this.x+this.padding,this.bar_y=this.y+this.padding,this.bar_height=this.height-2*this.padding,this.bar_max_width=this.width-2*this.padding,this.bar_width=this.bar_max_width*this.percent,this.bar_color=t.bar_color}update(t,e,s){this.min=e??this.min,this.max=s??this.max,this.value=t,this.value<this.min&&(this.value=this.min),this.value>this.max&&(this.value=this.max),this.percent=this.value/this.max,this.bar_width=(this.width-2*this.padding)*this.percent}draw(t){t.ctx.save(),this.radius?(t.ctx.beginPath(),t.ctx.fillStyle=this.gradient_bar_color(this.bar_color,t.ctx,this.bar_x,this.bar_max_width),t.ctx.roundRect(this.bar_x,this.bar_y,this.bar_width,this.bar_height,[this.radius]),t.ctx.fill()):(t.ctx.fillStyle=this.gradient_bar_color(this.bar_color,t.ctx,this.bar_x,this.bar_max_width),t.ctx.fillRect(this.bar_x,this.bar_y,this.bar_width,this.bar_height)),t.ctx.restore()}gradient_bar_color(t,e,s,i){if(Array.isArray(t)){if(t.length>=2){const h=100/(t.length-1)/100;let a=e.createLinearGradient(s,0,i+s,0);return t.forEach(((t,e)=>{a.addColorStop(e*h,t)})),a}return 1===t.length&&t[0]?t[0]:"black"}return t}}class N{key_filter=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"," ","Enter"];last_key;constructor(){this.last_key="",window.addEventListener("keydown",(t=>{this.key_filter.indexOf(t.key)>-1&&(t.preventDefault(),t.stopPropagation(),"ArrowLeft"===t.key&&(this.last_key="PRESS left"),"ArrowRight"===t.key&&(this.last_key="PRESS right"),"ArrowUp"===t.key&&(this.last_key="PRESS up"),"ArrowDown"===t.key&&(this.last_key="PRESS down")," "===t.key&&(this.last_key="PRESS space"),"Enter"===t.key&&(this.last_key="PRESS enter"),console.log(this.last_key))})),window.addEventListener("keyup",(t=>{this.key_filter.indexOf(t.key)>-1&&(t.preventDefault(),t.stopPropagation(),"ArrowLeft"===t.key&&(this.last_key="RELEASE left"),"ArrowRight"===t.key&&(this.last_key="RELEASE right"),"ArrowUp"===t.key&&(this.last_key="RELEASE up"),"ArrowDown"===t.key&&(this.last_key="RELEASE down")," "===t.key&&(this.last_key="RELEASE space"),"Enter"===t.key&&(this.last_key="RELEASE enter"),console.log(this.last_key))}))}}class X{text;value;x;y;destination_x;destination_y;speed_x;speed_y;mark_delete;timer;constructor(t){this.text=t.text,this.value=t.value,this.x=t.x,this.y=t.y,this.destination_x=t.destination_x,this.destination_y=t.destination_y,this.speed_x=.01*(this.destination_x-this.x),this.speed_y=.01*(this.destination_y-this.y),this.mark_delete=!1,this.timer=100}update(){this.x+=this.speed_x,this.y+=this.speed_y,this.timer--,this.timer<=0&&(this.mark_delete=!0)}draw(t){r({text_color:this.value<=0?"red":"white",ctx:t.ctx,x:this.x,y:this.y,text:this.text,font_weight:30})}}class Y extends S{color;constructor(t){super({x:t.x,y:t.y}),this.color=t.color}draw(s){s.ctx.beginPath(),s.ctx.arc(e(this.x),e(this.y),this.size,0,t),s.ctx.fillStyle=this.color,s.ctx.fill()}}const H=50,J=30;class Q{name;x;y;uid;uid_text;uid_number;img;color;width;height;constructor(t){t.width??=H,t.height??=H,t.color??="rgba(255,255,255,0.1)",this.uid=a(),this.uid_number=`${this.uid[0]},${this.uid[1]},${this.uid[2]}`,this.uid_text=`rgb(${this.uid[0]},${this.uid[1]},${this.uid[2]})`,this.name=t.name,this.img=new Image,this.img.src=t.img,this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.color=t.color}draw(s){s.ctx.fillStyle=this.color,s.ctx.beginPath(),s.ctx.arc(e(this.x+.5*this.width),e(this.y+.5*this.width),25,0,t),s.ctx.fill(),s.ctx.drawImage(this.img,0,0,16,16,e(this.x),e(this.y),this.width,this.height)}draw_mark(s){s.ctx.fillStyle=this.uid_text,s.ctx.beginPath(),s.ctx.arc(e(this.x+.5*this.width),e(this.y+.5*this.width),35,0,t),s.ctx.fill()}}class V{canvas_width;canvas_height;pause;info;left;left_action;left_down;left_up;right;right_action;right_down;right_up;btn_list=[];constructor(t){this.canvas_width=t.canvas_width,this.canvas_height=t.canvas_height,this.info=new Q({name:"Info",img:"./res/ctl/info.svg",x:this.canvas_width-H-J,y:110}),this.pause=new Q({name:"Enter",img:"./res/ctl/pause.svg",x:this.canvas_width-H-J,y:this.info.y+H+J}),this.left=new Q({name:"ArrowLeft",img:"./res/ctl/left.svg",x:J,y:this.canvas_height-J-H}),this.left_up=new Q({name:"ArrowUp",img:"./res/ctl/up.svg",x:110,y:this.canvas_height-60-100}),this.left_down=new Q({name:"ArrowDown",img:"./res/ctl/down.svg",x:110,y:this.canvas_height-J-H}),this.left_action=new Q({name:" ",img:"./res/ctl/action.svg",x:J,y:this.canvas_height-60-100}),this.right=new Q({name:"ArrowRight",img:"./res/ctl/right.svg",x:this.canvas_width-J-H,y:this.canvas_height-J-H}),this.right_up=new Q({name:"ArrowUp",img:"./res/ctl/up.svg",x:this.canvas_width-60-100,y:this.canvas_height-60-100}),this.right_down=new Q({name:"ArrowDown",img:"./res/ctl/down.svg",x:this.canvas_width-60-100,y:this.canvas_height-J-H}),this.right_action=new Q({name:" ",img:"./res/ctl/action.svg",x:this.canvas_width-J-H,y:this.canvas_height-60-100}),this.btn_list=[this.pause,this.info,this.left,this.left_up,this.left_down,this.left_action,this.right,this.right_up,this.right_down,this.right_action]}draw(t){this.btn_list.forEach((e=>{e.draw({ctx:t.ctx}),e.draw_mark({ctx:t.ctxMark})}))}last_touch_x=-1;last_touch_y=-1;get_touch_location(t){return t.touches&&t.touches.length>0&&t.touches[0]&&(this.last_touch_x=t.touches[0].clientX,this.last_touch_y=t.touches[0].clientY),{x:this.last_touch_x,y:this.last_touch_y}}touch_event(t){let{x:e,y:s}=this.get_touch_location(t.e);if(e>-1&&s>-1){const i=e-t.canvas_rect.left,h=s-t.canvas_rect.top,a=t.ctx_canvas_mark.getImageData(i,h,1,1).data;if(a&&a.length>3&&a[0]&&a[1]&&a[2]){if(a[0]>0&&a[1]>0&&a[2]>0){const e=this.btn_list.filter((t=>t.uid[0]===a[0]&&t.uid[1]===a[1]&&t.uid[2]===a[2]));if(e&&e.length>0&&e[0]){const s=e[0].name;"Info"!==s&&window.dispatchEvent(new KeyboardEvent(t.event_name,{key:s}))}}}else 0===a[0]&&0===a[1]&&0===a[2]&&window.dispatchEvent(new KeyboardEvent(t.event_name,{key:" "}))}}attach_click(t){const e=t.canvas_mark.getBoundingClientRect();t.canvas_mark.addEventListener("touchstart",(s=>{this.touch_event({event_name:"keydown",ctx_canvas_mark:t.ctx_canvas_mark,canvas_rect:e,e:s})})),t.canvas_mark.addEventListener("touchend",(s=>{this.touch_event({event_name:"keyup",ctx_canvas_mark:t.ctx_canvas_mark,canvas_rect:e,e:s})}))}}class W{x;y;width;height;bg_color;shadow_color;shadow_blur;shadow_x;shadow_y;shadow_width;shadow_height;radius;constructor(t){t.height??=20,t.shadow_color??="#555555",t.shadow_blur??=1,t.bg_color??="#FFFFFF",t.radius??=5,this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.radius=t.radius,this.bg_color=t.bg_color,this.shadow_color=t.shadow_color,this.shadow_blur=t.shadow_blur,this.shadow_x=this.x-this.shadow_blur,this.shadow_y=this.y-this.shadow_blur,this.shadow_width=this.width+2*this.shadow_blur,this.shadow_height=this.height+2*this.shadow_blur}draw(t){t.ctx.save(),this.radius?(this.shadow_color&&this.shadow_blur&&(t.ctx.beginPath(),t.ctx.fillStyle=this.shadow_color,t.ctx.roundRect(this.shadow_x,this.shadow_y,this.shadow_width,this.shadow_height,[this.radius]),t.ctx.fill()),t.ctx.beginPath(),t.ctx.fillStyle=this.bg_color,t.ctx.roundRect(this.x,this.y,this.width,this.height,[this.radius]),t.ctx.fill()):(this.shadow_color&&this.shadow_blur&&(t.ctx.fillStyle=this.shadow_color,t.ctx.fillRect(this.shadow_x,this.shadow_y,this.shadow_width,this.shadow_height)),t.ctx.fillStyle=this.bg_color,t.ctx.fillRect(this.x,this.y,this.width,this.height)),t.ctx.restore()}}class Z{x;y;text_value;text_align;font_weight;font_family;text_color;shadow_color;shadow_blur;constructor(t){this.x=t.x,this.y=t.y,this.text_value=t.text,this.text_align=t.text_align,this.font_weight=t.font_weight,this.font_family=t.font_family,this.text_color=t.text_color,this.shadow_color=t.shadow_color,this.shadow_blur=t.shadow_blur}draw(t){r({ctx:t.ctx,x:this.x,y:this.y,text:this.text_value,text_align:this.text_align,font_weight:this.font_weight,font_family:this.font_family,text_color:this.text_color,shadow_color:this.shadow_color,shadow_blur:this.shadow_blur})}}class tt{debug;canvas_width;canvas_height;progress=[];text=[];box=[];constructor(t){if(t.debug??=!1,this.debug=t.debug,this.canvas_width=t.canvas_width,this.canvas_height=t.canvas_height,this.text.push(new Z({x:20,y:60,text:"🎮",shadow_blur:0,font_weight:40})),this.text.push(new Z({x:.5*(this.canvas_width-.4*this.canvas_width),y:35,text:"Level",text_align:"start"})),this.text.push(new Z({x:this.canvas_width-150,y:45,text:"🧡",text_align:"end",shadow_blur:0})),this.text.push(new Z({x:this.canvas_width-150,y:75,text:"🚀",text_align:"end",shadow_blur:0})),this.debug){let t=100,e=0;const s=s=>new Z({x:20,y:t+20*e++,shadow_blur:0,text:s,text_color:"yellow",font_family:"Arial",font_weight:15});this.text.push(s("FPS :")),this.text.push(s("Dust :")),this.text.push(s("Fire :")),this.text.push(s("Explosion :")),this.text.push(s("Enemy :")),this.text.push(s("Score :")),this.text.push(s("Random :"))}this.progress.push(new W({x:.5*this.canvas_width-.4*this.canvas_width*.5,y:45,width:.4*this.canvas_width})),this.progress.push(new W({x:this.canvas_width-130,y:30,width:100})),this.progress.push(new W({x:this.canvas_width-130,y:60,width:100}))}draw(t){[...this.text,...this.progress,...this.box].forEach((e=>{e.draw({ctx:t.ctx})}))}}const et={enemy1:class extends d{life_index;life_length;constructor(t){const e=.1*h()+.3,s=293*e,i=155*e;super({...t,img:c,x:h()*(t.canvas_width-s)+.5*t.canvas_width,y:h()*(t.canvas_height-i),width:s,height:i,sprite_width:293,sprite_height:155,sprite_length:5,explode_in:!0,explode_out:!0,point:4}),this.life_index=0,this.life_length=5e3*h()+5e3}update(t){this.x+=7*h()-3.5,this.y+=7*h()-3.5,this.life_index+=t.delta_time,this.life_index>this.life_length&&(this.mark_delete=!0),super.update(t)}},enemy2:class extends d{move_speed;angle;angle_speed;curve;constructor(t){const e=.1*h()+.3,s=266*e,i=188*e;super({...t,img:p,x:t.canvas_width,y:h()*(t.canvas_height-i),width:s,height:i,sprite_width:266,sprite_height:188,sprite_length:5,have_particle:!0,point:3}),this.move_speed=4*h()+1,this.angle=2*h(),this.angle_speed=.2*h(),this.curve=5*h()}update(t){this.x-=this.move_speed,this.x<0-this.width&&(this.mark_delete=!0),this.y+=this.curve*Math.sin(this.angle),this.angle+=this.angle_speed,super.update(t)}},enemy3:class extends d{angle;angle_speed;life_index;life_length;constructor(t){const e=.1*h()+.3,s=218*e,i=177*e;super({...t,img:g,x:t.canvas_width,y:h()*(t.canvas_height-i),width:s,height:i,sprite_width:218,sprite_height:177,sprite_length:5,explode_out:!0,have_particle:!0,point:3}),this.angle=2*h(),this.angle_speed=.5*h()+.5,this.life_index=0,this.life_length=5e3*h()+5e3}update(t){this.x=this.canvas_width/2*Math.cos(this.angle*Math.PI/90)+(this.canvas_width/2-this.width/2),this.x+this.width<0&&(this.x=this.canvas_width),this.y=this.canvas_height/2*Math.sin(this.angle*Math.PI/270)+(this.canvas_height/2-this.height/2),this.y+this.height<0&&(this.y=this.canvas_height),this.angle+=this.angle_speed,this.life_index+=t.delta_time,this.life_index>this.life_length&&(this.mark_delete=!0),super.update(t)}},enemy4:class extends d{new_x;new_y;last_move;interval;life_index;life_length;constructor(t){const s=.1*h()+.3,i=213*s,a=213*s;super({...t,img:u,x:h()*(t.canvas_width-i)+.5*t.canvas_width,y:h()*(t.canvas_height-a),width:i,height:a,sprite_width:213,sprite_height:213,sprite_length:8,explode_in:!0,explode_out:!0,have_particle:!0,point:5}),this.new_x=h()*(t.canvas_width-i),this.new_y=h()*(t.canvas_height-a),this.last_move=0,this.interval=e(200*h()+50),this.life_index=0,this.life_length=5e3*h()+5e3}update(t){this.last_move%this.interval==0&&(this.last_move=0,this.new_x=h()*(this.canvas_width-this.width),this.new_y=h()*(this.canvas_height-this.height)),this.last_move++;let e=this.x-this.new_x,s=this.y-this.new_y;this.x-=e/20,this.y-=s/20,this.life_index+=t.delta_time,this.life_index>this.life_length&&(this.mark_delete=!0),super.update(t)}set_position(t){super.set_position(t),this.new_x-=t.game_speed,this.collision_x=this.x+this.collision_adjust_x+this.width*this.collision_scale}},enemy5:class extends d{direction_x;direction_y;constructor(t){const e=.1*h()+.3,s=271*e,i=194*e;super({...t,img:y,x:t.canvas_width,y:h()*(t.canvas_height-i),width:s,height:i,sprite_width:271,sprite_height:194,sprite_length:5,have_particle:!0,point:3}),this.direction_x=3*h()+1.5,this.direction_y=5*h()-2.5}update(t){this.x-=this.direction_x,this.y-=this.direction_y,this.x<0-this.width&&(this.mark_delete=!0),(this.y<0||this.y>this.canvas_height-this.height)&&(this.direction_y=-1*this.direction_y),super.update(t)}},enemy6:class extends d{speed;angle;curve;constructor(t){const e=.1*h()+.3,s=261*e,i=209*e;super({...t,img:x,x:t.canvas_width,y:h()*t.canvas_height*.5,width:s,height:i,sprite_width:261,sprite_height:209,sprite_length:5,point:4}),this.speed=2*h()+2,this.angle=0,this.curve=3*h()}update(t){this.x-=this.speed,this.y+=Math.sin(this.angle)*this.curve,this.angle+=.04,this.x<0-this.width&&(this.mark_delete=!0),super.update(t)}draw(t){t.ctx.save(),t.ctx.globalAlpha=.5,super.draw(t),t.ctx.restore()}},enemy7:class extends d{move_speed;constructor(t){const e=.1*h()+.3,s=229*e,i=171*e;super({...t,img:m,x:t.canvas_width+s,y:t.canvas_height-i,width:s,height:i,sprite_width:229,sprite_height:171,sprite_length:5,point:2}),this.move_speed=10*h()+5}update(t){this.x-=h()*this.move_speed,this.x<0-this.width&&(this.mark_delete=!0),super.update(t)}},enemy8:class extends d{destination_y;speed;string_x;string_y;constructor(t){const e=.1*h()+.3,s=310*e,i=175*e;super({...t,img:w,x:t.canvas_width+s,y:h()>.5?h()*(t.canvas_height-i):0-i,width:s,height:i,sprite_width:310,sprite_height:175,sprite_length:5,point:3}),this.destination_y=h()*(.8*(t.canvas_height-this.height)),this.speed=2*h()-4,this.y<this.destination_y&&(this.speed*=-1),this.string_x=this.x+.5*this.width,this.string_y=this.y+10}update(t){this.y+=this.speed,this.string_y=this.y+10,this.string_x=this.x+.5*this.width,this.y>this.destination_y&&this.speed>0&&(this.speed*=-1),this.y<0-this.height-5&&(this.mark_delete=!0),super.update(t)}draw(t){t.ctx.beginPath(),t.ctx.moveTo(this.string_x,0),t.ctx.lineTo(this.string_x,this.string_y),t.ctx.stroke(),super.draw(t)}set_position(t){super.set_position(t),this.string_x=this.x+.5*this.width,this.collision_x=this.x+this.collision_adjust_x+this.width*this.collision_scale}},enemy9:class extends d{move_speed;angle;angle_speed;curve;constructor(t){const e=.8*h()+1.1,s=60*e,i=44*e;super({...t,img:v,x:t.canvas_width,y:h()*(t.canvas_height-i),width:s,height:i,sprite_width:60,sprite_height:44,sprite_length:5,have_particle:!0,point:3}),this.move_speed=4*h()+1,this.angle=2*h(),this.angle_speed=.2*h(),this.curve=5*h()}update(t){this.x-=this.move_speed,this.x<0-this.width&&(this.mark_delete=!0),this.y+=this.curve*Math.sin(this.angle),this.angle+=this.angle_speed,super.update(t)}},enemy10:class extends d{constructor(t){const e=.75*h()+.95,s=60*e,i=87*e;super({...t,img:f,x:t.canvas_width+s,y:t.canvas_height-i,width:s,height:i,sprite_width:60,sprite_height:87,sprite_length:5,point:1})}},enemy11:class extends d{destination_y;speed;string_x;string_y;constructor(t){const e=.5*h()+.7,s=120*e,i=144*e;super({...t,img:b,x:t.canvas_width+s,y:h()>.5?h()*(t.canvas_height-i):0-i,width:s,height:i,sprite_width:120,sprite_height:144,sprite_length:5,point:3}),this.destination_y=h()*(.8*(t.canvas_height-this.height)),this.speed=2*h()-4,this.y<this.destination_y&&(this.speed*=-1),this.string_x=this.x+.5*this.width,this.string_y=this.y+50}update(t){this.y+=this.speed,this.string_y=this.y+50,this.string_x=this.x+.5*this.width,this.y>this.destination_y&&this.speed>0&&(this.speed*=-1),this.y<0-this.height-5&&(this.mark_delete=!0),super.update(t)}draw(t){t.ctx.beginPath(),t.ctx.moveTo(this.string_x,0),t.ctx.lineTo(this.string_x,this.string_y),t.ctx.stroke(),super.draw(t)}set_position(t){super.set_position(t),this.string_x=this.x+.5*this.width,this.collision_x=this.x+this.collision_adjust_x+this.width*this.collision_scale}}},st=["enemy1","enemy2","enemy3","enemy4","enemy5","enemy6","enemy7","enemy8","enemy9","enemy10","enemy11"];class it{canvasMark;ctx;ctlCtx;ctlMarkCtx;guiCtx;valCtx;canvas_width;canvas_height;base_height;ctl;gui;bg;player;input;prg_game;prg_life;prg_power;enemy_list=[];explosion_list=[];dust_list=[];fire_list=[];score_list=[];progress_list=[];dust_max=50;fire_max=50;fps_min=30;debug=false;game_up=!1;game_over=!1;game_timeout=!1;game_pause=!1;game_fps=0;game_fps_list=[];score_value=0;score_text="0";progress_index=0;progress_max=1e3;progress_timer=0;progress_timer_index=0;game_level=1;enemy_index=0;enemy_interval=0;enemy_interval_max=1e3;constructor(t){this.canvasMark=t.canvasMark,this.ctx=t.ctx,this.guiCtx=t.guiCtx,this.ctlMarkCtx=t.ctlMarkCtx,this.ctlCtx=t.ctlCtx,this.valCtx=t.valCtx,this.canvas_width=t.canvas_width,this.canvas_height=t.canvas_height,this.input=new N,this.ctl=new V({canvas_width:this.canvas_width,canvas_height:this.canvas_height}),this.gui=new tt({canvas_width:this.canvas_width,canvas_height:this.canvas_height,debug:this.debug}),this.bg=new _({canvas_width:this.canvas_width,canvas_height:this.canvas_height}),this.base_height=this.canvas_height-this.bg.ground,this.player=new G({canvas_width:this.canvas_width,canvas_height:this.base_height,debug:this.debug}),this.prg_game=new K({x:.5*this.canvas_width-.4*this.canvas_width*.5,y:45,min:0,max:this.progress_max,width:.4*this.canvas_width,value:this.progress_index,bar_color:["red","yellow","green"]}),this.prg_life=new K({x:this.canvas_width-130,y:30,width:100,value:this.player.life,max:100,bar_color:["red","yellow","green"]}),this.prg_power=new K({x:this.canvas_width-130,y:60,width:100,value:this.player.power,max:100,bar_color:["red","yellow","green"]}),setTimeout((()=>{this.gui.draw({ctx:this.guiCtx}),("ontouchstart"in window||navigator.maxTouchPoints>0)&&(this.ctl.draw({ctx:this.ctlCtx,ctxMark:this.ctlMarkCtx}),this.ctl.attach_click({canvas_mark:this.canvasMark,ctx_canvas_mark:this.ctlMarkCtx}))}),1e3)}gen_enemy_interval(){return this.enemy_interval_max-100*this.game_level}game_start(){this.game_level=1,this.progress_index=0,this.progress_max=1e3,this.progress_timer=performance.now()+6e4,this.progress_timer_index=60,this.enemy_index=0;let t=this.gen_enemy_interval();this.enemy_interval=h()*t+t,this.enemy_list=[],this.explosion_list=[],this.dust_list=[],this.fire_list=[],this.score_list=[],this.player.set_state("idle"),this.player.life=100,this.player.power=0,this.player.speed=0,this.player.max_speed=14+this.game_level,this.player.weight=1,this.player.velocity_y=0,this.player.y=this.base_height-this.player.height,this.player.powered=!1,this.player.invulnerable=!1,this.score_value=0,this.score_text="0",window.removeEventListener("keyup",this.game_stop_listener),window.addEventListener("keyup",this.game_pause_listener),this.game_over=!1,this.game_timeout=!1,this.cleanup_ctxvalue_message(),requestAnimationFrame((t=>{this.animate(t)}))}game_level_up(){this.game_level++,this.progress_index=0,this.progress_max=1e3+100*this.game_level,this.progress_timer=performance.now()+6e4,this.progress_timer_index=60,this.enemy_index=0;let t=this.gen_enemy_interval();this.enemy_interval=h()*t+t,this.enemy_list=[],this.explosion_list=[],this.dust_list=[],this.fire_list=[],this.player.set_state("idle"),this.player.life+=10,this.player.life>100&&(this.player.life=100),this.player.speed=0,this.player.max_speed=14+this.game_level,this.player.weight=1,this.player.velocity_y=0,this.player.y=this.base_height-this.player.height,this.player.powered=!1,this.player.invulnerable=!1,window.removeEventListener("keyup",this.game_stop_listener),window.addEventListener("keyup",this.game_pause_listener),this.game_up=!1,this.cleanup_ctxvalue_message(),requestAnimationFrame((t=>{this.animate(t)}))}game_continue(){this.progress_timer=performance.now()+1e3*this.progress_timer_index,this.game_pause=!1,this.cleanup_ctxvalue_message(),requestAnimationFrame((t=>{this.animate(t)}))}add_explosion(t,e){this.explosion_list.push(new E({x:t.x+.5*t.width,y:t.y+.5*t.height,scale:.008*t.width,play_sound:e}))}add_floating_score(t,s){let i=e(.1*(100-t.y/(t.canvas_height-t.height+this.base_height)*100)*t.point);s&&i>0&&(i*=-1),!s&&i<0&&(i*=-1),this.score_list.push(new X({text:`${i>0?"+":""}${i}`,value:i,x:t.x+.5*t.width,y:t.y+.5*t.height,destination_x:90,destination_y:60}))}collision_detection(){this.enemy_list.forEach((t=>{t.mark_delete||t.is_collide({player:this.player})&&(this.player.is_powered()?(t.explode_out=!1,this.add_explosion(t,!0),this.add_floating_score(t,!1),t.mark_delete=!0):(this.player.invulnerable||(this.player.life>30?(this.player.life-=10,this.player.set_state("gethit")):this.player.life>0?(this.player.life-=10,this.player.set_state("dizzy")):(this.player.set_state("ko"),setTimeout((()=>{this.game_over=!0,window.removeEventListener("keyup",this.game_pause_listener),window.addEventListener("keyup",this.game_stop_listener)}),500))),this.game_over||this.game_timeout||(t.explode_out=!1,this.add_explosion(t,!1),this.add_floating_score(t,!0),t.mark_delete=!0)))}))}draw_message(t,e,s){r({ctx:this.valCtx,x:.5*this.canvas_width,y:.5*this.base_height-20,text:t,font_weight:60,text_align:"center",text_color:s}),r({ctx:this.valCtx,x:.5*this.canvas_width,y:.5*this.base_height+20,text:e,font_weight:30,text_align:"center",text_color:s})}cleanup_ctxvalue_debug(){this.valCtx.clearRect(60,85,50,20),this.valCtx.clearRect(63,105,50,20),this.valCtx.clearRect(58,125,50,20),this.valCtx.clearRect(95,145,50,20),this.valCtx.clearRect(75,165,50,20),this.valCtx.clearRect(70,185,50,20),this.valCtx.clearRect(88,205,70,20)}cleanup_ctxvalue(){this.valCtx.clearRect(80,20,250,50),this.valCtx.clearRect(.5*this.canvas_width-.4*this.canvas_width*.5+40,15,30,25),this.valCtx.clearRect(.5*this.canvas_width+.4*this.canvas_width*.5-45,15,50,25),this.valCtx.clearRect(.5*this.canvas_width-.4*this.canvas_width*.5,45,.4*this.canvas_width,20),this.valCtx.clearRect(this.canvas_width-130,30,100,20),this.valCtx.clearRect(this.canvas_width-130,60,100,20)}cleanup_ctxvalue_message(){this.valCtx.clearRect(.5*(this.canvas_width-.5*this.canvas_width),.5*(this.canvas_height-this.bg.ground)-70,.5*this.canvas_width,100)}draw_status(){this.cleanup_ctxvalue(),r({ctx:this.valCtx,x:90,y:60,text:`${this.score_text}`,text_color:this.score_value<0?"red":"white",font_weight:40}),r({ctx:this.valCtx,x:.5*(this.canvas_width-this.prg_game.width)+47,y:35,text:`${this.game_level}`,text_align:"start"}),r({ctx:this.valCtx,x:.5*(this.canvas_width+this.prg_game.width),y:35,text:`0:${this.progress_timer_index.toString().padStart(2,"0")}`,text_align:"end",text_color:this.progress_timer_index<20?"red":"white"}),this.prg_game.update(this.progress_index,0,this.progress_max),this.prg_life.update(this.player.life),this.prg_power.update(this.player.power),[this.prg_game,this.prg_life,this.prg_power].forEach((t=>t.draw({ctx:this.valCtx}))),this.game_over&&this.draw_message("Game over!","Press SPACEBAR to try again.","red"),this.game_timeout&&this.draw_message("Time up!","Press SPACEBAR to try again.","red"),this.game_up&&this.draw_message(`Level ${this.game_level} complete!`,"Press SPACEBAR to try again.","green"),this.game_pause&&this.draw_message("Pause!","Press ENTER to try again.","white")}last_timestamp=0;update(t){const s=t-this.last_timestamp;if(this.last_timestamp=t,this.progress_index+=.1*this.player.speed,this.progress_index>=this.progress_max&&(this.game_up=!0,window.removeEventListener("keyup",this.game_pause_listener),window.addEventListener("keyup",this.game_stop_listener)),this.progress_timer_index=e(.001*(this.progress_timer-t)),this.progress_timer_index<=0&&(this.game_timeout=!0,window.removeEventListener("keyup",this.game_pause_listener),window.addEventListener("keyup",this.game_stop_listener)),this.player.power+=.1,this.player.power>100&&(this.player.power=100),this.bg.update({game_speed:this.player.speed}),this.player.update_input(this.input),this.player.update({delta_time:s}),this.player.speed===this.player.max_speed&&Array(3).fill("").forEach((t=>{this.fire_list.unshift(new j({x:this.player.x-40+10*h()-10,y:this.player.y+25+10*h()-10}))})),this.enemy_index>=this.enemy_interval){const t=st[e(h()*st.length)],s=new(0,et[t])({canvas_width:this.canvas_width,canvas_height:this.base_height,debug:this.debug});s.explode_in&&this.explosion_list.push(new E({x:s.x+.5*s.width,y:s.y+.5*s.height,scale:s.width/s.sprite_width*1.5,play_sound:!1})),this.enemy_list.push(s),this.enemy_list.sort(((t,e)=>t.width-e.width));let i=this.gen_enemy_interval();this.enemy_interval=h()*i+i,this.enemy_index=0}else this.enemy_index+=s;[...this.fire_list,...this.dust_list,...this.explosion_list].forEach((t=>{t.update({delta_time:s}),t.set_position({game_speed:this.player.speed})})),this.score_list.forEach((t=>{t.update(),t.mark_delete&&(this.score_value+=t.value,this.score_text=this.score_value.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))})),this.enemy_list.forEach((t=>{t.update({delta_time:s}),t.set_position({game_speed:this.player.speed}),t.x<0-t.width?t.mark_delete=!0:t.mark_delete&&t.explode_out&&this.add_explosion(t,!1),t.have_particle&&this.dust_list.unshift(new Y({x:t.x+.5*t.width+50*h()-25,y:t.y+.5*t.height+30*h()-15,color:`rgba(${t.uid_number},0.2)`}))})),this.collision_detection(),this.score_list=this.score_list.filter((t=>!t.mark_delete)),this.dust_list=this.dust_list.filter((t=>!t.mark_delete)),this.fire_list=this.fire_list.filter((t=>!t.mark_delete)),this.explosion_list=this.explosion_list.filter((t=>!t.mark_delete)),this.enemy_list=this.enemy_list.filter((t=>!t.mark_delete)),this.dust_list.length>this.dust_max&&(this.dust_list=this.dust_list.slice(0,this.dust_max)),this.fire_list.length>this.fire_max&&(this.fire_list=this.fire_list.slice(0,this.fire_max))}draw(){[this.bg,...this.fire_list,...this.dust_list,...this.score_list,...this.enemy_list,this.player,...this.explosion_list].forEach((t=>{t.draw({ctx:this.ctx})}))}game_stop_listener=t=>{" "===t.key&&(this.game_up||this.game_over||this.game_timeout)&&(t.preventDefault(),t.stopPropagation(),(this.game_over||this.game_timeout)&&this.game_start(),this.game_up&&this.game_level_up())};game_pause_listener=t=>{"Enter"===t.key&&(this.game_up||this.game_over||this.game_timeout||(t.preventDefault(),t.stopPropagation(),this.game_pause?this.game_pause&&this.game_continue():this.game_pause=!0))};is_enough_fps(t,e){const s=t-1e3;this.game_fps_list.length>this.fps_min&&(this.game_fps_list=this.game_fps_list.filter((t=>t>s))),this.game_fps_list.push(t),this.game_fps=this.game_fps_list.length,this.game_fps>=this.fps_min?e(t):requestAnimationFrame((t=>{this.is_enough_fps(t,e)}))}debug_info(){this.cleanup_ctxvalue_debug();let t=0;const e=(e,s,i)=>{r({ctx:this.valCtx,x:e,y:100+20*t++,shadow_blur:0,text:s,text_color:i||"yellow",font_family:"Arial",font_weight:15})};e(63,`${this.game_fps}`,this.game_fps<30?"red":"yellow"),e(65,`${this.dust_list.length}`),e(60,`${this.fire_list.length}`),e(100,`${this.explosion_list.length}`),e(80,`${this.enemy_list.length}`),e(75,`${this.score_list.length}`),e(90,`${s}`)}do_animate=t=>{this.update(t),this.draw(),this.draw_status(),this.debug&&this.debug_info(),this.game_over||this.game_timeout||this.game_pause||this.game_up||requestAnimationFrame((t=>{this.animate(t)}))};animate(t){this.debug?this.is_enough_fps(t,this.do_animate):this.do_animate(t)}}const ht=document.getElementById("gameCanvas"),at=document.getElementById("staticCanvas"),rt=document.getElementById("valueCanvas"),nt=document.getElementById("controlCanvas"),lt=document.getElementById("controlMarkerCanvas");document.addEventListener("DOMContentLoaded",(()=>{if(ht&&at&&rt&&nt&&lt){[ht,at,rt,nt,lt].forEach((t=>{t.width=1300,t.height=700}));const t=ht.getContext("2d"),e=at.getContext("2d"),s=rt.getContext("2d"),i=nt.getContext("2d"),h=lt.getContext("2d");t&&e&&s&&i&&h&&new it({canvasMark:lt,ctx:t,guiCtx:e,ctlCtx:i,ctlMarkCtx:h,valCtx:s,canvas_width:ht.width,canvas_height:ht.height}).game_start()}else console.error("gameCanvas not found")}))})();